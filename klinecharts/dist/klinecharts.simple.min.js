/**
 * @license
 * KLineChart v8.6.2
 * Copyright (c) 2019 lihu.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).klinecharts=e()}(this,(function(){"use strict";var t={technicalIndicatorExtensions:{},shapeExtensions:{},addTechnicalIndicatorTemplate:function(t){var e=this;t&&[].concat(t).forEach((function(t){t.name&&(e.technicalIndicatorExtensions[t.name]=t)}))},addShapeTemplate:function(t){var e=this;t&&[].concat(t).forEach((function(t){t.name&&(e.shapeExtensions[t.name]=t)}))}};function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var i=0;e.length>i;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function a(t,e){if(h(t)&&h(e))for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&i in t){var n=t[i],r=e[i];h(r)&&h(n)&&!s(r)&&!s(n)?a(n,r):u(e[i])&&(t[i]=e[i])}}function o(t){if(!h(t))return t;var e;for(var i in e=s(t)?[]:{},t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=t[i];e[i]=h(n)?o(n):n}return e}function s(t){return"[object Array]"===Object.prototype.toString.call(t)}function c(t){return t&&"function"==typeof t}function h(t){return!!t&&"object"===r(t)}function l(t){return"number"==typeof t&&!isNaN(t)}function u(t){return null!=t}function f(t){return"boolean"==typeof t}function d(t){return"string"==typeof t}var v="stroke",_="fill",p="dash",y="solid",m="left",g="right",x="normal",S="percentage",k="log",b="candle_solid",w="candle_stroke",E="candle_up_stroke",P="candle_down_stroke",A="ohlc",C="area",T="always",I="follow_cross",O="rect",D="standard",M="circle",L="rect",R="triangle",F="diamond",B="custom",z="point",H="top",j="bottom",V={grid:{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:p,dashValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:p,dashValue:[2,2]}},candle:{margin:{top:.2,bottom:.1},type:b,bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#999999"},area:{lineSize:2,lineColor:"#2196F3",value:"close",backgroundColor:[{offset:0,color:"rgba(33, 150, 243, 0.01)"},{offset:1,color:"rgba(33, 150, 243, 0.2)"}]},priceMark:{show:!0,high:{show:!0,color:"#76808F",textMargin:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},low:{show:!0,color:"#76808F",textMargin:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},last:{show:!0,upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",line:{show:!0,style:p,dashValue:[4,4],size:1},text:{show:!0,size:12,paddingLeft:2,paddingTop:2,paddingRight:2,paddingBottom:2,color:"#FFFFFF",family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{showRule:T,showType:D,labels:["时间: ","开: ","收: ","高: ","低: ","成交量: "],values:null,defaultValue:"n/a",rect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,offsetLeft:8,offsetTop:8,offsetRight:8,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",backgroundColor:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0}}},technicalIndicator:{margin:{top:.2,bottom:.1},bar:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},line:{size:1,dashValue:[2,2],colors:["#FF9600","#9D65C9","#2196F3","#E11D74","#01C5C4"]},circle:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},lastValueMark:{show:!1,text:{show:!1,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:3,paddingTop:2,paddingRight:3,paddingBottom:2,borderRadius:2}},tooltip:{showRule:T,showType:D,showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8}}},xAxis:{show:!0,height:null,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",paddingTop:3,paddingBottom:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},yAxis:{show:!0,width:null,type:x,position:g,inside:!1,reverse:!1,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:3,paddingRight:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},separator:{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:"rgba(33, 150, 243, 0.08)"},crosshair:{show:!0,horizontal:{show:!0,line:{show:!0,style:p,dashValue:[4,2],size:1,color:"#76808F"},text:{show:!0,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#686D76",borderRadius:2,backgroundColor:"#686D76"}},vertical:{show:!0,line:{show:!0,style:p,dashValue:[4,2],size:1,color:"#76808F"},text:{show:!0,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderRadius:2,borderColor:"#686D76",backgroundColor:"#686D76"}}},shape:{point:{backgroundColor:"#2196F3",borderColor:"rgba(33, 150, 243, 0.35)",borderSize:1,radius:5,activeBackgroundColor:"#2196F3",activeBorderColor:"rgba(33, 150, 243, 0.35)",activeBorderSize:3,activeRadius:5},line:{style:y,color:"#2196F3",size:1,dashValue:[2,2]},polygon:{style:v,stroke:{style:y,size:1,color:"#2196F3",dashValue:[2,2]},fill:{color:"#2196F3"}},arc:{style:v,stroke:{style:y,size:1,color:"#2196F3",dashValue:[2,2]},fill:{color:"#2196F3"}},text:{style:_,color:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",offset:[0,0]}},annotation:{position:H,offset:[20,0],symbol:{type:F,size:8,color:"#2196F3",activeSize:10,activeColor:"#FF9600"}},tag:{position:z,offset:0,line:{show:!0,style:p,dashValue:[4,2],size:1,color:"#2196F3"},text:{color:"#FFFFFF",backgroundColor:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderRadius:2,borderSize:1,borderColor:"#2196F3"},mark:{offset:0,color:"#FFFFFF",backgroundColor:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderRadius:2,borderSize:1,borderColor:"#2196F3"}}};function Y(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"--";if(h(t)){var n=t[e];if(u(n))return n}return i}function W(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"MM-DD hh:mm";if(l(e)){var n=t.format(new Date(e)),r=n.split(", "),a=r[0].split("/"),o={YYYY:a[2],MM:a[0],DD:a[1],"hh:mm":"24"===r[1].match(/^[\d]{2}/)[0]?r[1].replace(/^[\d]{2}/,"00"):r[1]};return i.replace(/YYYY|MM|DD|(hh:mm)/g,(function(t){return o[t]}))}return"--"}function N(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=+t;return(i||0===i)&&l(i)?i.toFixed(e):"".concat(i)}function X(t){return l(+t)?t>1e9?"".concat(+(t/1e9).toFixed(3),"B"):t>1e6?"".concat(+(t/1e6).toFixed(3),"M"):t>1e3?"".concat(+(t/1e3).toFixed(3),"K"):t:"--"}function G(t,e,i){var n=0,r=0;for(r=t.length-1;n!==r;){var a=Math.floor((r+n)/2),o=r-n,s=t[a][e];if(i===t[n][e])return n;if(i===t[r][e])return r;if(i===s)return a;if(i>s?n=a:r=a,2>=o)break}return n}function U(t,e){return null==e&&(e=10),+(t=(+t).toFixed(e=Math.min(Math.max(0,e),20)))}function Z(t){return Math.log(t)/Math.log(10)}function K(t){return Math.pow(10,t)}var $={ZOOM:"zoom",SCROLL:"scroll",CROSSHAIR:"crosshair",TOOLTIP:"tooltip",PANE_DRAG:"pane_drag"};function q(t){return Object.values($).indexOf(t)>-1}var J=function(){function t(i){e(this,t),this._chartStore=i,this._dateTimeFormat=new Intl.DateTimeFormat("en",{hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),this._zoomEnabled=!0,this._scrollEnabled=!0,this._loading=!0,this._loadMoreCallback=null,this._more=!0,this._totalDataSpace=0,this._dataSpace=6,this._barSpace=this._calcBarSpace(),this._offsetRightSpace=50,this._offsetRightBarCount=this._offsetRightSpace/this._dataSpace,this._leftMinVisibleBarCount=2,this._rightMinVisibleBarCount=2,this._from=0,this._to=0,this._preOffsetRightBarCount=0}return n(t,[{key:"_calcBarSpace",value:function(){return Math.max(1,Math.min(Math.floor(.82*this._dataSpace),Math.floor(this._dataSpace)-1))}},{key:"adjustFromTo",value:function(){var t=this._chartStore.dataList().length,e=this._totalDataSpace/this._dataSpace,i=e-Math.min(this._leftMinVisibleBarCount,t);this._offsetRightBarCount>i&&(this._offsetRightBarCount=i);var n=-t+Math.min(this._rightMinVisibleBarCount,t);n>this._offsetRightBarCount&&(this._offsetRightBarCount=n),this._to=Math.round(this._offsetRightBarCount+t+.5),this._from=Math.round(this._to-e)-1,this._to>t&&(this._to=t),0>this._from&&(this._from=0),this._chartStore.adjustVisibleDataList(),0===this._from&&this._more&&!this._loading&&c(this._loadMoreCallback)&&(this._loading=!0,this._loadMoreCallback(Y(this._chartStore.dataList()[0],"timestamp")))}},{key:"setMore",value:function(t){this._more=t}},{key:"setLoading",value:function(t){this._loading=t}},{key:"dateTimeFormat",value:function(){return this._dateTimeFormat}},{key:"setTimezone",value:function(t){var e;try{e=new Intl.DateTimeFormat("en",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(t){}e&&(this._dateTimeFormat=e)}},{key:"timezone",value:function(){return this._dateTimeFormat.resolvedOptions().timeZone}},{key:"dataSpace",value:function(){return this._dataSpace}},{key:"barSpace",value:function(){return this._barSpace}},{key:"halfBarSpace",value:function(){return this._barSpace/2}},{key:"setDataSpace",value:function(t,e){1>t||t>50||this._dataSpace===t||(this._dataSpace=t,this._barSpace=this._calcBarSpace(),e&&e(),this.adjustFromTo(),this._chartStore.crosshairStore().recalculate(!0),this._chartStore.invalidate())}},{key:"setTotalDataSpace",value:function(t){this._totalDataSpace!==t&&(this._totalDataSpace=t,this.adjustFromTo(),this._chartStore.crosshairStore().recalculate(!0))}},{key:"setOffsetRightSpace",value:function(t,e){this._offsetRightSpace=t,this._offsetRightBarCount=t/this._dataSpace,e&&(this.adjustFromTo(),this._chartStore.crosshairStore().recalculate(!0),this._chartStore.invalidate())}},{key:"resetOffsetRightSpace",value:function(){this.setOffsetRightSpace(this._offsetRightSpace)}},{key:"offsetRightSpace",value:function(){return this._offsetRightSpace}},{key:"offsetRightBarCount",value:function(){return this._offsetRightBarCount}},{key:"setOffsetRightBarCount",value:function(t){this._offsetRightBarCount=t}},{key:"setLeftMinVisibleBarCount",value:function(t){this._leftMinVisibleBarCount=t}},{key:"setRightMinVisibleBarCount",value:function(t){this._rightMinVisibleBarCount=t}},{key:"from",value:function(){return this._from}},{key:"to",value:function(){return this._to}},{key:"startScroll",value:function(){this._preOffsetRightBarCount=this._offsetRightBarCount}},{key:"scroll",value:function(t,e){if(this._scrollEnabled){var i=t/this._dataSpace;this._chartStore.actionStore().execute($.SCROLL,{barCount:i,distance:t}),this._offsetRightBarCount=this._preOffsetRightBarCount-i,this.adjustFromTo();var n=e||this._chartStore.crosshairStore().get();this._chartStore.crosshairStore().set(n,!0),this._chartStore.invalidate()}}},{key:"getDataByDataIndex",value:function(t){return this._chartStore.dataList()[t]}},{key:"coordinateToFloatIndex",value:function(t){var e=this._chartStore.dataList().length;return Math.round(1e6*(e+this._offsetRightBarCount-(this._totalDataSpace-t)/this._dataSpace))/1e6}},{key:"dataIndexToTimestamp",value:function(t){var e=this.getDataByDataIndex(t);if(e)return e.timestamp}},{key:"timestampToDataIndex",value:function(t){return 0===this._chartStore.dataList().length?0:G(this._chartStore.dataList(),"timestamp",t)}},{key:"dataIndexToCoordinate",value:function(t){var e=this._chartStore.dataList().length;return this._totalDataSpace-(e+this._offsetRightBarCount-t-.5)*this._dataSpace}},{key:"coordinateToDataIndex",value:function(t){return Math.ceil(this.coordinateToFloatIndex(t))-1}},{key:"zoom",value:function(t,e){var i=this;if(this._zoomEnabled){if(!e||!u(e.x)){var n=this._chartStore.crosshairStore().get();e={x:u(n.x)?n.x:this._totalDataSpace/2}}this._chartStore.actionStore().execute($.ZOOM,{coordinate:e,scale:t});var r=this.coordinateToFloatIndex(e.x);this.setDataSpace(this._dataSpace+t*(this._dataSpace/10),(function(){i._offsetRightBarCount+=r-i.coordinateToFloatIndex(e.x)}))}}},{key:"setZoomEnabled",value:function(t){this._zoomEnabled=t}},{key:"zoomEnabled",value:function(){return this._zoomEnabled}},{key:"setScrollEnabled",value:function(t){this._scrollEnabled=t}},{key:"scrollEnabled",value:function(){return this._scrollEnabled}},{key:"setLoadMoreCallback",value:function(t){this._loadMoreCallback=t}},{key:"clear",value:function(){this._more=!0,this._loading=!0,this._from=0,this._to=0}}]),t}();function Q(t,e){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Q(t,e)}function tt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Q(t,e)}function et(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function it(t){return it=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},it(t)}function nt(t,e,i,n,r,a,o){try{var s=t[a](o),c=s.value}catch(t){return void i(t)}s.done?e(c):Promise.resolve(c).then(n,r)}var rt={exports:{}},at={exports:{}};!function(t){function e(i){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(i)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}(at),function(t){var e=at.exports.default;function i(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
t.exports=i=function(){return n},t.exports.__esModule=!0,t.exports.default=t.exports;var n={},r=Object.prototype,a=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",h=o.toStringTag||"@@toStringTag";function l(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,i){return t[e]=i}}function u(t,e,i,n){var r=Object.create((e&&e.prototype instanceof v?e:v).prototype),a=new P(n||[]);return r._invoke=function(t,e,i){var n="suspendedStart";return function(r,a){if("executing"===n)throw Error("Generator is already running");if("completed"===n){if("throw"===r)throw a;return C()}for(i.method=r,i.arg=a;;){var o=i.delegate;if(o){var s=b(o,i);if(s){if(s===d)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var c=f(t,e,i);if("normal"===c.type){if(n=i.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(n="completed",i.method="throw",i.arg=c.arg)}}}(t,i,a),r}function f(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}n.wrap=u;var d={};function v(){}function _(){}function p(){}var y={};l(y,s,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(A([])));g&&g!==r&&a.call(g,s)&&(y=g);var x=p.prototype=v.prototype=Object.create(y);function S(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,i){function n(r,o,s,c){var h=f(t[r],t,o);if("throw"!==h.type){var l=h.arg,u=l.value;return u&&"object"==e(u)&&a.call(u,"__await")?i.resolve(u.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):i.resolve(u).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(h.arg)}var r;this._invoke=function(t,e){function a(){return new i((function(i,r){n(t,e,i,r)}))}return r=r?r.then(a,a):a()}}function b(t,e){var i=t.iterator[e.method];if(void 0===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=f(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,d;var r=n.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function A(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(a.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:C}}function C(){return{value:void 0,done:!0}}return _.prototype=p,l(x,"constructor",p),l(p,"constructor",_),_.displayName=l(p,h,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,l(t,h,"GeneratorFunction")),t.prototype=Object.create(x),t},n.awrap=function(t){return{__await:t}},S(k.prototype),l(k.prototype,c,(function(){return this})),n.AsyncIterator=k,n.async=function(t,e,i,r,a){void 0===a&&(a=Promise);var o=new k(u(t,e,i,r),a);return n.isGeneratorFunction(e)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(x),l(x,h,"Generator"),l(x,s,(function(){return this})),l(x,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},n.values=A,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(i,n){return o.type="throw",o.arg=t,e.next=i,n&&(e.method="next",e.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return i("end");if(this.prev>=r.tryLoc){var s=a.call(r,"catchLoc"),c=a.call(r,"finallyLoc");if(s&&c){if(r.catchLoc>this.prev)return i(r.catchLoc,!0);if(r.finallyLoc>this.prev)return i(r.finallyLoc)}else if(s){if(r.catchLoc>this.prev)return i(r.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(r.finallyLoc>this.prev)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(this.prev>=n.tryLoc&&a.call(n,"finallyLoc")&&n.finallyLoc>this.prev){var r=n;break}}r&&("break"===t||"continue"===t)&&e>=r.tryLoc&&r.finallyLoc>=e&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,d):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),E(i),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var r=n.arg;E(i)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:A(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),d}},n}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports}(rt);var ot=rt.exports(),st=ot;try{regeneratorRuntime=ot}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=ot:Function("r","regeneratorRuntime = r")(ot)}var ct="line",ht="bar",lt="circle",ut={PRICE:"price",VOLUME:"volume",NORMAL:"normal"};function ft(t,e,i,n,r,a){var o=a.color,s=a.isStroke,h=a.isDashed,l={prev:{kLineData:t[i-1],technicalIndicatorData:e[i-1]},current:{kLineData:t[i],technicalIndicatorData:e[i]},next:{kLineData:t[i+1],technicalIndicatorData:e[i+1]}};return u(n.color)&&(o=c(n.color)?n.color(l,r)||a.color:n.color||a.color),u(n.isStroke)&&(s=c(n.isStroke)?n.isStroke(l):n.isStroke),u(n.isDashed)&&(h=c(n.isDashed)?n.isDashed(l):n.isDashed),{color:o,isStroke:s,isDashed:h}}var dt=function(){function t(i){var n=i.name,r=i.shortName,a=i.series,o=i.calcParams,c=i.plots,h=i.precision,d=i.shouldCheckParamCount,v=i.shouldOhlc,_=i.shouldFormatBigNumber,p=i.minValue,y=i.maxValue,m=i.styles,g=i.extendData;e(this,t),this.name=n||"",this.shortName=u(r)?r:n,this.series=-1!==Object.values(ut).indexOf(a)?a:ut.NORMAL,this.precision=l(h)&&h>=0?h:4,this._precisionFlag=!1,this.calcParams=s(o)?o:[],this.plots=s(c)?c:[],this.shouldCheckParamCount=!f(d)||d,this.shouldOhlc=!!f(v)&&v,this.shouldFormatBigNumber=!!f(_)&&_,this.minValue=p,this.maxValue=y,this.styles=m,this.extendData=g,this.result=[]}var i,r;return n(t,[{key:"_createParams",value:function(t){return t.map((function(t){return h(t)?t.value:t}))}},{key:"setShortName",value:function(t){return!(!u(t)||this.shortName===t)&&(this.shortName=t,!0)}},{key:"setPrecision",value:function(t,e){return!(!l(t)||0>t||e&&(!e||this._precisionFlag))&&(this.precision=parseInt(t,10),e||(this._precisionFlag=!0),!0)}},{key:"setCalcParams",value:function(t){if(!s(t))return!1;if(this.shouldCheckParamCount&&t.length!==this.calcParams.length)return!1;for(var e=[],i=0;t.length>i;i++){var n=t[i],r=void 0,a=void 0;h(n)?(r=n.value,a=n.allowDecimal):(r=n,a=!1);var o=this.calcParams[i];if(h(o)&&f(o.allowDecimal)&&(a=o.allowDecimal),!l(r)||!a&&parseInt(r,10)!==r)return!1;e.push({allowDecimal:a,value:r})}this.calcParams=e;var c=this.regeneratePlots(this._createParams(e));return c&&s(c)&&(this.plots=c),!0}},{key:"setShouldOhlc",value:function(t){return!(!f(t)||this.shouldOhlc===t)&&(this.shouldOhlc=t,!0)}},{key:"setShouldFormatBigNumber",value:function(t){return!(!f(t)||this.shouldFormatBigNumber===t)&&(this.shouldFormatBigNumber=t,!0)}},{key:"setStyles",value:function(t,e){return!!h(t)&&(this.styles||(this.styles={margin:o(e.margin),bar:o(e.bar),line:o(e.line),circle:o(e.circle)}),a(this.styles,t),!0)}},{key:"setExtendData",value:function(t){return void 0!==t&&this.extendData!==t&&(this.extendData=t,!0)}},{key:"calc",value:(i=st.mark((function t(e){return st.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.calcTechnicalIndicator(e,{params:this._createParams(this.calcParams),plots:this.plots,extendData:this.extendData});case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0=[];case 5:this.result=t.t0;case 6:case"end":return t.stop()}}),t,this)})),r=function(){var t=this,e=arguments;return new Promise((function(n,r){var a=i.apply(t,e);function o(t){nt(a,n,r,o,s,"next",t)}function s(t){nt(a,n,r,o,s,"throw",t)}o(void 0)}))},function(t){return r.apply(this,arguments)})},{key:"calcTechnicalIndicator",value:function(t,e){}},{key:"regeneratePlots",value:function(t){}}]),t}();function vt(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return _t(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _t(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return t.length>n?{done:!1,value:t[n++]}:{done:!0}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function _t(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);e>i;i++)n[i]=t[i];return n}function pt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var yt=function(){function i(t){e(this,i),this._chartStore=t,this._templates=this._createTemplates(),this._instances=new Map}return n(i,[{key:"_createTechInfo",value:function(t){return{name:t.name,shortName:t.shortName,series:t.series,calcParams:t.calcParams,shouldCheckParamCount:t.shouldCheckParamCount,shouldOhlc:t.shouldOhlc,shouldFormatBigNumber:t.shouldFormatBigNumber,precision:t.precision,styles:t.styles,plots:t.plots,result:t.result||[]}}},{key:"_createTemplates",value:function(){var e={},i=t.technicalIndicatorExtensions;for(var n in i){var r=this._createTemplateInstance(i[n]);r&&(e[n]=r)}return e}},{key:"_createTemplateInstance",value:function(t){var i,r=t.name,s=t.shortName,l=t.series,u=t.calcParams,f=t.plots,d=t.precision,v=t.shouldCheckParamCount,_=t.shouldOhlc,p=t.shouldFormatBigNumber,y=t.minValue,m=t.maxValue,g=t.styles,x=t.extendData,S=t.calcTechnicalIndicator,k=t.regeneratePlots,b=t.createToolTipDataSource,w=t.render;if(!r||!c(S))return null;if(h(g)){var E=this._chartStore.styleOptions().technicalIndicator;a(i={margin:o(E.margin),bar:o(E.bar),line:o(E.line),circle:o(E.circle)},g)}var P=function(t){tt(o,t);var a=pt(o);function o(){return e(this,o),a.call(this,{name:r,shortName:s,series:l,calcParams:u,plots:f,precision:d,shouldCheckParamCount:v,shouldOhlc:_,shouldFormatBigNumber:p,minValue:y,maxValue:m,defaultStyles:i,extendData:x})}return n(o)}(dt);return P.prototype.calcTechnicalIndicator=S,c(k)&&(P.prototype.regeneratePlots=k),c(b)&&(P.prototype.createToolTipDataSource=b),c(w)&&(P.prototype.render=w),new P}},{key:"addTemplate",value:function(t){var e=this;t.forEach((function(t){var i=e._createTemplateInstance(t||{});i&&(e._templates[i.name]=i)}))}},{key:"hasTemplate",value:function(t){return!!this._templates[t]}},{key:"getTemplateInfo",value:function(t){if(!u(t)){var e={};for(var i in this._templates){e[i]=this._createTechInfo(this._templates[i])}return e}var n=this._templates[t];return n?this._createTechInfo(n):{}}},{key:"addInstance",value:function(t,e,i){var n=e.name,r=e.calcParams,a=e.precision,o=e.shouldOhlc,s=e.shouldFormatBigNumber,c=e.styles,h=e.extendData,l=this._instances.get(t);if(!l||!l.has(n)){l||(l=new Map,this._instances.set(t,l));var u=this._templates[n],f=Object.create(Object.getPrototypeOf(u));for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(f[d]=u[d]);return f.setCalcParams(r),f.setPrecision(a),f.setShouldOhlc(o),f.setShouldFormatBigNumber(s),f.setStyles(c,this._chartStore.styleOptions().technicalIndicator),f.setExtendData(h),i||l.clear(),l.set(n,f),f.calc(this._chartStore.dataList())}}},{key:"instances",value:function(t){return this._instances.get(t)||new Map}},{key:"removeInstance",value:function(t,e){var i=!1;if(this._instances.has(t)){var n=this._instances.get(t);u(e)?n.has(e)&&(n.delete(e),i=!0):(n.clear(),i=!0),0===n.size&&this._instances.delete(t)}return i}},{key:"hasInstance",value:function(t){return this._instances.has(t)}},{key:"calcInstance",value:function(t,e){var i=this,n=[];if(u(t))if(u(e)){var r=this._instances.get(e);r&&r.has(t)&&n.push(r.get(t).calc(this._chartStore.dataList()))}else this._instances.forEach((function(e){e.has(t)&&n.push(e.get(t).calc(i._chartStore.dataList()))}));else this._instances.forEach((function(t){t.forEach((function(t){n.push(t.calc(i._chartStore.dataList()))}))}));return Promise.all(n)}},{key:"getInstanceInfo",value:function(t,e){var i=this,n=function(t){var n,r=[],a=vt(t);try{for(a.s();!(n=a.n()).done;){var o=n.value[1];if(o){var s=i._createTechInfo(o);if(o.name===e)return s;r.push(s)}}}catch(t){a.e(t)}finally{a.f()}return r};if(!u(t)){var r={};return this._instances.forEach((function(t,e){r[e]=n(t)})),r}return this._instances.has(t)?n(this._instances.get(t)):{}}},{key:"setSeriesPrecision",value:function(t,e){var i=function(i){i.series===ut.PRICE&&i.setPrecision(t,!0),i.series===ut.VOLUME&&i.setPrecision(e,!0)};for(var n in this._templates)i(this._templates[n]);this._instances.forEach((function(t){t.forEach((function(t){i(t)}))}))}},{key:"override",value:function(t,e){var i=this,n=t.name,r=t.shortName,a=t.calcParams,o=t.precision,s=t.shouldOhlc,c=t.shouldFormatBigNumber,h=t.styles,l=t.extendData,f=this._chartStore.styleOptions().technicalIndicator,d=new Map;if(u(e))this._instances.has(e)&&d.set(e,this._instances.get(e));else{d=this._instances;var v=this._templates[n];v&&(v.setCalcParams(a),v.setShortName(r),v.setPrecision(o),v.setShouldOhlc(s),v.setShouldFormatBigNumber(c),v.setStyles(h,f),v.setExtendData(l))}var _=!1,p=[];if(d.forEach((function(t){if(t.has(n)){var e=t.get(n),u=e.setShortName(r),d=e.setCalcParams(a),v=e.setPrecision(o),y=e.setShouldOhlc(s),m=e.setShouldFormatBigNumber(c),g=e.setStyles(h,f),x=e.setExtendData(l);(u||d||v||y||m||g||x)&&(_=!0),d&&p.push(e.calc(i._chartStore.dataList()))}})),_)return Promise.all(p)}}]),i}();function mt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function gt(t,e){e.forEach((function(e){var i=e.key,n=e.fn;c(n)&&(t[i]=n)}))}var xt=function(){function t(i){var n=i.id,r=i.chartStore,a=i.points,o=i.xAxis,s=i.yAxis;e(this,t),this._id=n,this._chartStore=r,this._points=a,this._xAxis=o,this._yAxis=s,this._styles=null}return n(t,[{key:"draw",value:function(t){}},{key:"setStyles",value:function(t,e){return!!h(t)&&(this._styles||(this._styles=o(e)),a(this._styles,t),!0)}},{key:"id",value:function(){return this._id}},{key:"styles",value:function(){return this._styles}},{key:"points",value:function(){return this._points}},{key:"setYAxis",value:function(t){t&&(this._yAxis=t)}},{key:"checkEventCoordinateOn",value:function(t){}},{key:"onClick",value:function(t){}},{key:"onRightClick",value:function(t){}},{key:"onMouseEnter",value:function(t){}},{key:"onMouseLeave",value:function(t){}}]),t}();function St(t,e,i,n){t.fillStyle=e,t.beginPath(),t.arc(i.x,i.y,n,0,2*Math.PI),t.closePath(),t.fill()}function kt(t,e,i){var n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),a=Math.abs(i.x-t.x);return Math.abs(n*Math.abs(i.y-t.y)-a*r)/2}function bt(t,e,i){if(!i)return!1;var n=i.x-t.x,r=i.y-t.y;return!(n*n+r*r>e*e)}function wt(t,e,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),t.beginPath();var n=!0;e.forEach((function(e){e&&(n?(t.moveTo(e.x,e.y),n=!1):t.lineTo(e.x,e.y))})),i(),t.restore()}function Et(t,e){wt(t,e,(function(){t.closePath(),t.stroke()}))}function Pt(t,e){wt(t,e,(function(){t.closePath(),t.fill()}))}function At(t,e,i,n){t.beginPath();var r=t.lineWidth%2?.5:0;t.moveTo(i,e+r),t.lineTo(n,e+r),t.stroke(),t.closePath()}function Ct(t,e,i,n){t.beginPath();var r=t.lineWidth%2?.5:0;t.moveTo(e+r,i),t.lineTo(e+r,n),t.stroke(),t.closePath()}function Tt(t,e){wt(t,e,(function(){t.stroke(),t.closePath()}))}function It(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||2}function Ot(t,e){return Math.round(t.measureText(e).width)}function Dt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Helvetica Neue";return"".concat(e," ").concat(t,"px ").concat(i)}function Mt(t,e,i){t.font=Dt(i.size,i.weight,i.family);var n=Ot(t,e);return i.paddingLeft+i.paddingRight+n+2*(i.borderSize||0)}function Lt(t){return t.paddingTop+t.paddingBottom+t.size+2*(t.borderSize||0)}function Rt(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return Ft(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ft(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return t.length>n?{done:!1,value:t[n++]}:{done:!0}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function Ft(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);e>i;i++)n[i]=t[i];return n}function Bt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var zt="other",Ht="point",jt="none",Vt="line",Yt="text",Wt="continuous_line",Nt="polygon",Xt="arc",Gt=0,Ut=1,Zt=2,Kt={NORMAL:"normal",WEAK_MAGNET:"weak_magnet",STRONG_MAGNET:"strong_magnet"};var $t=function(t){tt(r,t);var i=Bt(r);function r(t){var n,a=t.id,o=t.name,s=t.totalStep,c=t.chartStore,h=t.xAxis,l=t.yAxis,u=t.points,f=void 0===u?[]:u,d=t.styles,v=t.lock,_=t.mode,p=t.data;return e(this,r),(n=i.call(this,{id:a,chartStore:c,points:f,xAxis:h,yAxis:l}))._name=o,n._totalStep=s,n._lock=v,n._mode=Kt.NORMAL,n.setMode(_),n._data=p,n._drawStep=1,n.setPoints(f),n.setStyles(d,c.styleOptions().shape),n._prevPressPoint=null,n._prevPoints=null,n._coordinates=[],n}return n(r,[{key:"setPoints",value:function(t){if(s(t)&&t.length>0){var e;this._totalStep-1>t.length?(this._drawStep=t.length+1,this._points=o(t),e=t.length):(this._drawStep=-1,this._points=t.slice(0,this._totalStep-1),e=this._totalStep-1);for(var i=0;e>i;i++)this.performEventMoveForDrawing({step:i+2,mode:this._mode,points:this._points,movePoint:this._points[i],xAxis:this._xAxis,yAxis:this._yAxis});return-1===this._drawStep&&this.performEventPressedMove({mode:this._mode,points:this._points,pressPointIndex:this._points.length-1,pressPoint:this._points[this._points.length-1],xAxis:this._xAxis,yAxis:this._yAxis}),!0}}},{key:"_timestampOrDataIndexToCoordinateX",value:function(t){var e=t.timestamp,i=t.dataIndex;return e&&(i=this._chartStore.timeScaleStore().timestampToDataIndex(e)),this._xAxis.convertToPixel(i)}},{key:"_drawLines",value:function(t,e,i,n){t.save(),t.strokeStyle=i.color||n.color,t.lineWidth=i.size||n.size,i.style===p&&t.setLineDash(i.dashValue||n.dashValue),e.forEach((function(e){var i,n;if(e.length>1)switch((i=e[0]).x===(n=e[1]).x?Zt:i.y===n.y?Ut:Gt){case Gt:Tt(t,e);break;case Ut:At(t,e[0].y,e[0].x,e[1].x);break;case Zt:Ct(t,e[0].x,e[0].y,e[1].y)}})),t.restore()}},{key:"_drawContinuousLines",value:function(t,e,i,n){t.save(),t.strokeStyle=i.color||n.color,t.lineWidth=i.size||n.size,i.style===p&&t.setLineDash(i.dashValue||n.dashValue),e.forEach((function(e){e.length>0&&Tt(t,e)})),t.restore()}},{key:"_drawPolygons",value:function(t,e,i,n){var r;if(t.save(),i.style===_)t.fillStyle=(i.fill||n.fill).color,r=Pt;else{var a=i.stroke||n.stroke;a.style===p&&t.setLineDash(a.dashValue),t.lineWidth=a.size,t.strokeStyle=a.color,r=Et}e.forEach((function(e){e.length>0&&r(t,e)})),t.restore()}},{key:"_drawArcs",value:function(t,e,i,n){if(t.save(),i.style===_)t.fillStyle=(i.fill||n.fill).color;else{var r=i.stroke||n.stroke;r.style===p&&t.setLineDash(r.dashValue),t.lineWidth=r.size,t.strokeStyle=r.color}e.forEach((function(e){var n=e.x,r=e.y,a=e.radius,o=e.startAngle,s=e.endAngle;t.beginPath(),t.arc(n,r,a,o,s),i.style===_?(t.closePath(),t.fill()):(t.stroke(),t.closePath())})),t.restore()}},{key:"_drawText",value:function(t,e,i,n){var r;t.save(),i.style===v?(t.strokeStyle=i.color||n.color,r=t.strokeText):(t.fillStyle=i.color||n.color,r=t.fillText),t.font=Dt(i.size||n.size,i.weight||n.weight,i.family||n.family);var a=i.offset||n.offset||[0,0];e.forEach((function(e){r.call(t,e.text,e.x+a[1],e.y+a[0])})),t.restore()}},{key:"draw",value:function(t){var e=this;this._coordinates=this._points.map((function(t){var i=t.value;return{x:e._timestampOrDataIndexToCoordinateX({timestamp:t.timestamp,dataIndex:t.dataIndex}),y:e._yAxis.convertToPixel(i)}}));var i=this._styles||this._chartStore.styleOptions().shape;if(1!==this._drawStep&&this._coordinates.length>0){var n={width:this._xAxis.width(),height:this._yAxis.height()},r={price:this._chartStore.pricePrecision(),volume:this._chartStore.volumePrecision()};this._shapeDataSources=this.createShapeDataSource({step:this._drawStep,mode:this._mode,points:this._points,coordinates:this._coordinates,viewport:{width:this._xAxis.width(),height:this._yAxis.height()},precision:{price:this._chartStore.pricePrecision(),volume:this._chartStore.volumePrecision()},styles:i,xAxis:this._xAxis,yAxis:this._yAxis,data:this._data})||[],this._shapeDataSources.forEach((function(n){var r=n.styles,a=n.dataSource,o=void 0===a?[]:a;if(n.isDraw)switch(n.type){case Vt:e._drawLines(t,o,r||i.line,i.line);break;case Wt:e._drawContinuousLines(t,o,r||i.line,i.line);break;case Nt:e._drawPolygons(t,o,r||i.polygon,i.polygon);break;case Xt:e._drawArcs(t,o,r||i.arc,i.arc);break;case Yt:e._drawText(t,o,r||i.text,i.text)}})),this.drawExtend&&(t.save(),this.drawExtend({ctx:t,dataSource:this._shapeDataSources,styles:i,viewport:n,precision:r,mode:this._mode,xAxis:this._xAxis,yAxis:this._yAxis,data:this._data}),t.restore())}var a=this._chartStore.shapeStore().eventOperate();(a.hover.id===this._id&&a.hover.element!==jt||a.click.id===this._id&&a.click.element!==jt||this.isDrawing())&&this._coordinates.forEach((function(n,r){var o=n.x,s=n.y,c=i.point.radius,h=i.point.backgroundColor,l=i.point.borderColor,u=i.point.borderSize;a.hover.id===e._id&&a.hover.element===Ht&&r===a.hover.elementIndex&&(c=i.point.activeRadius,h=i.point.activeBackgroundColor,l=i.point.activeBorderColor,u=i.point.activeBorderSize),St(t,l,{x:o,y:s},c+u),St(t,h,{x:o,y:s},c)}))}},{key:"setLock",value:function(t){this._lock=t}},{key:"name",value:function(){return this._name}},{key:"lock",value:function(){return this._lock}},{key:"totalStep",value:function(){return this._totalStep}},{key:"mode",value:function(){return this._mode}},{key:"setMode",value:function(t){Object.values(Kt).indexOf(t)>-1&&(this._mode=t)}},{key:"setData",value:function(t){return void 0!==t&&t!==this._data&&(this._data=t,!0)}},{key:"data",value:function(){return this._data}},{key:"isDrawing",value:function(){return-1!==this._drawStep}},{key:"isStart",value:function(){return 1===this._drawStep}},{key:"checkEventCoordinateOn",value:function(t){for(var e=this._styles||this._chartStore.styleOptions().shape,i=this._coordinates.length-1;i>-1;i--)if(bt(this._coordinates[i],e.point.radius,t))return{id:this._id,element:Ht,elementIndex:i,instance:this};if(this._shapeDataSources){var n,r=Rt(this._shapeDataSources);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=a.key,s=a.type,c=a.dataSource,h=void 0===c?[]:c;if(a.isCheck)for(var l=0;h.length>l;l++){if(this.checkEventCoordinateOnShape({key:o,type:s,dataSource:h[l],eventCoordinate:t}))return{id:this._id,element:zt,elementIndex:l,instance:this}}}}catch(t){r.e(t)}finally{r.f()}}}},{key:"_performValue",value:function(t,e,i){var n=this._yAxis.convertFromPixel(t);if(this._mode===Kt.NORMAL||"candle_pane"!==i)return n;var r=this._chartStore.timeScaleStore().getDataByDataIndex(e);if(!r)return n;if(n>r.high){if(this._mode===Kt.WEAK_MAGNET){var a=this._yAxis.convertToPixel(r.high);return this._yAxis.convertFromPixel(a-8)>n?r.high:n}return r.high}if(r.low>n){if(this._mode===Kt.WEAK_MAGNET){var o=this._yAxis.convertToPixel(r.low);return n>this._yAxis.convertFromPixel(o-8)?r.low:n}return r.low}var s=Math.max(r.open,r.close);if(n>s)return r.high-n>n-s?s:r.high;var c=Math.min(r.open,r.close);return c>n?c-n>n-r.low?r.low:c:n-c>s-n?s:c}},{key:"mouseMoveForDrawing",value:function(t,e){var i=this._xAxis.convertFromPixel(t.x),n=this._chartStore.timeScaleStore().dataIndexToTimestamp(i),r=this._performValue(t.y,i,e.paneId);this._points[this._drawStep-1]={timestamp:n,value:r,dataIndex:i},this.performEventMoveForDrawing({step:this._drawStep,mode:this._mode,points:this._points,movePoint:{timestamp:n,value:r,dataIndex:i},xAxis:this._xAxis,yAxis:this._yAxis}),this.onDrawing({id:this._id,step:this._drawStep,points:this._points})}},{key:"mouseLeftButtonDownForDrawing",value:function(){this._drawStep===this._totalStep-1?(this._drawStep=-1,this._chartStore.shapeStore().progressInstanceComplete(),this.onDrawEnd({id:this._id,points:this._points})):this._drawStep++}},{key:"mousePressedPointMove",value:function(t,e){var i=this._chartStore.shapeStore().eventOperate(),n=i.click.elementIndex;if(!this._lock&&i.click.id===this._id&&i.click.element===Ht&&-1!==n){var r=this._xAxis.convertFromPixel(t.x),a=this._chartStore.timeScaleStore().dataIndexToTimestamp(r),o=this._performValue(t.y,r,e.paneId);this._points[n].timestamp=a,this._points[n].dataIndex=r,this._points[n].value=o,this.performEventPressedMove({points:this._points,mode:this._mode,pressPointIndex:n,pressPoint:{dataIndex:r,timestamp:a,value:o},xAxis:this._xAxis,yAxis:this._yAxis}),this.onPressedMove({id:this._id,element:Ht,points:this._points,event:e})}}},{key:"startPressedOtherMove",value:function(t){var e=this._xAxis.convertFromPixel(t.x),i=this._yAxis.convertFromPixel(t.y);this._prevPressPoint={dataIndex:e,value:i},this._prevPoints=o(this._points)}},{key:"mousePressedOtherMove",value:function(t,e){var i=this;if(!this._lock&&this._prevPressPoint){var n=this._xAxis.convertFromPixel(t.x),r=this._yAxis.convertFromPixel(t.y),a=n-this._prevPressPoint.dataIndex,o=r-this._prevPressPoint.value;this._points=this._prevPoints.map((function(t){u(t.dataIndex)||(t.dataIndex=i._chartStore.timeScaleStore().timestampToDataIndex(t.timestamp));var e=t.dataIndex+a;return{dataIndex:e,value:t.value+o,timestamp:i._chartStore.timeScaleStore().dataIndexToTimestamp(e)}})),this.onPressedMove({id:this._id,element:zt,points:this._points,event:e})}}},{key:"onDrawStart",value:function(t){}},{key:"onDrawing",value:function(t){}},{key:"onDrawEnd",value:function(t){}},{key:"onPressedMove",value:function(t){}},{key:"onRemove",value:function(t){}},{key:"checkEventCoordinateOnShape",value:function(t){}},{key:"createShapeDataSource",value:function(t){}},{key:"performEventMoveForDrawing",value:function(t){}},{key:"performEventPressedMove",value:function(t){}}]),r}(xt),qt=1,Jt=2,Qt=3;function te(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function ee(t){for(var e=1;arguments.length>e;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?te(Object(i),!0).forEach((function(e){mt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):te(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function ie(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return ne(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ne(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return t.length>n?{done:!1,value:t[n++]}:{done:!0}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function ne(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);e>i;i++)n[i]=t[i];return n}function re(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var ae=function(){function i(t){e(this,i),this._chartStore=t,this._templates=this._createTemplates(),this._eventOperate={click:{id:"",element:jt,elementIndex:-1},hover:{id:"",element:jt,elementIndex:-1}},this._progressInstance=null,this._pressedInstance=null,this._instances=new Map}return n(i,[{key:"_createTemplates",value:function(){var e={},i=t.shapeExtensions;for(var n in i){var r=this._createTemplateClass(i[n]);r&&(e[n]=r)}return e}},{key:"_createTemplateClass",value:function(t){var i=t.name,r=t.totalStep,a=t.checkEventCoordinateOnShape,o=t.createShapeDataSource,s=t.performEventPressedMove,h=t.performEventMoveForDrawing,u=t.drawExtend;if(!(i&&l(r)&&c(a)&&c(o)))return null;var f=function(t){tt(o,t);var a=re(o);function o(t){var n=t.id,s=t.chartStore,c=t.xAxis,h=t.yAxis,l=t.points,u=t.styles,f=t.lock,d=t.mode,v=t.data;return e(this,o),a.call(this,{id:n,name:i,totalStep:r,chartStore:s,xAxis:c,yAxis:h,points:l,styles:u,lock:f,mode:d,data:v})}return n(o)}($t);return f.prototype.checkEventCoordinateOnShape=a,f.prototype.createShapeDataSource=o,c(s)&&(f.prototype.performEventPressedMove=s),c(h)&&(f.prototype.performEventMoveForDrawing=h),c(u)&&(f.prototype.drawExtend=u),f}},{key:"addTemplate",value:function(t){var e=this;t.forEach((function(t){var i=e._createTemplateClass(t);i&&(e._templates[t.name]=i)}))}},{key:"getTemplate",value:function(t){return this._templates[t]}},{key:"getInstance",value:function(t){var e,i=ie(this._instances);try{for(i.s();!(e=i.n()).done;){var n=(e.value[1]||[]).find((function(e){return e.id()===t}));if(n)return n}}catch(t){i.e(t)}finally{i.f()}return null}},{key:"hasInstance",value:function(t){return!!this.getInstance(t)}},{key:"addInstance",value:function(t,e){t.isDrawing()?this._progressInstance={paneId:e,instance:t,fixed:u(e)}:(this._instances.has(e)||this._instances.set(e,[]),this._instances.get(e).push(t)),this._chartStore.invalidate(qt)}},{key:"progressInstance",value:function(){return this._progressInstance||{}}},{key:"progressInstanceComplete",value:function(){var t=this.progressInstance(),e=t.instance,i=t.paneId;e&&!e.isDrawing()&&(this._instances.has(i)||this._instances.set(i,[]),this._instances.get(i).push(e),this._progressInstance=null)}},{key:"updateProgressInstance",value:function(t,e){var i=this.progressInstance(),n=i.instance;n&&!i.fixed&&(n.setYAxis(t),this._progressInstance.paneId=e)}},{key:"pressedInstance",value:function(){return this._pressedInstance||{}}},{key:"updatePressedInstance",value:function(t,e,i){this._pressedInstance=t?{instance:t,paneId:e,element:i}:null}},{key:"instances",value:function(t){return this._instances.get(t)||[]}},{key:"setInstanceOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,i=t.styles,n=t.lock,r=t.mode,a=t.data,o=t.points,s=this._chartStore.styleOptions().shape,c=!1,h=function(t){t.setLock(n),t.setMode(r),(t.setStyles(i,s)||t.setData(a)||t.setPoints(o))&&(c=!0)};if(u(e)){var l=this.getInstance(e);l&&h(l)}else this._instances.forEach((function(t){return t.forEach(h)}));c&&this._chartStore.invalidate(qt)}},{key:"getInstanceInfo",value:function(t){var e=function(t){return{name:t.name(),id:t.id(),totalStep:t.totalStep(),lock:t.lock(),mode:t.mode(),points:t.points(),styles:t.styles(),data:t.data()}},i=this.progressInstance();if(!u(t)){var n={};return this._instances.forEach((function(t,r){n[r]=t.map((function(t){return e(t)})),i.paneId===r&&i.instance&&n[r].push(e(i.instance))})),n}if(i.instance&&i.instance.id()===t)return e(i.instance);var r=this.getInstance(t);return r?e(r):null}},{key:"removeInstance",value:function(t){var e=!1,i=this.progressInstance().instance;if(!i||u(t)&&i.id()!==t||(i.onRemove({id:i.id()}),this._progressInstance=null,e=!0),u(t)){var n,r=ie(this._instances);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=a[1]||[],s=o.findIndex((function(e){return e.id()===t}));if(s>-1){o[s].onRemove({id:o[s].id()}),o.splice(s,1),0===o.length&&this._instances.delete(a[0]),e=!0;break}}}catch(t){r.e(t)}finally{r.f()}}else this._instances.forEach((function(t){t.length>0&&t.forEach((function(t){t.onRemove({id:t.id()})}))})),this._instances.clear(),e=!0;e&&this._chartStore.invalidate(qt)}},{key:"eventOperate",value:function(){return this._eventOperate}},{key:"setEventOperate",value:function(t){var e,i,n=this._eventOperate,r=n.hover,a=n.click;return!t.hover||r.id===t.hover.id&&r.element===t.hover.element&&r.elementIndex===t.hover.elementIndex||(this._eventOperate.hover=ee({},t.hover),e=!0),!t.click||a.id===t.click.id&&a.element===t.click.element&&a.elementIndex===t.click.elementIndex||(this._eventOperate.click=ee({},t.click),i=!0),e||i}},{key:"isEmpty",value:function(){return 0===this._instances.size&&!this.progressInstance().instance}},{key:"isDrawing",value:function(){var t=this.progressInstance().instance;return t&&t.isDrawing()}},{key:"isPressed",value:function(){return!!this.pressedInstance().instance}}]),i}();function oe(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return se(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return se(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return t.length>n?{done:!1,value:t[n++]}:{done:!0}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function se(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);e>i;i++)n[i]=t[i];return n}function ce(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}var he=function(){function t(i){e(this,t),this._chartStore=i,this._annotations=new Map,this._visibleAnnotations=new Map,this._eventOperate={id:""}}return n(t,[{key:"eventOperate",value:function(){return this._eventOperate}},{key:"setEventOperate",value:function(t){t&&this._eventOperate.id!==t.id&&(this._eventOperate=function(t){for(var e=1;arguments.length>e;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ce(Object(i),!0).forEach((function(e){mt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ce(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},t))}},{key:"createVisibleAnnotations",value:function(){var t=this;this._visibleAnnotations.clear(),this._annotations.size>0&&this._chartStore.visibleDataList().forEach((function(e){var i=e.data,n=e.x;t._annotations.forEach((function(e,r){if(e.size>0){var a=e.get(i.timestamp)||[];if(a.length>0){var o,s=oe(a);try{for(s.s();!(o=s.n()).done;){var c=o.value;c.createSymbolCoordinate(n),t._visibleAnnotations.has(r)?t._visibleAnnotations.get(r).push(c):t._visibleAnnotations.set(r,[c])}}catch(t){s.e(t)}finally{s.f()}}}}))}))}},{key:"add",value:function(t,e){var i=this;this._annotations.has(e)||this._annotations.set(e,new Map),t.forEach((function(t){var n=i._annotations.get(e),r=t.points().timestamp;n.has(r)?n.get(r).push(t):n.set(r,[t])})),this.createVisibleAnnotations(),this._chartStore.invalidate(qt)}},{key:"get",value:function(t){return this._visibleAnnotations.get(t)}},{key:"remove",value:function(t,e){var i=!1;if(u(t)){if(this._annotations.has(t))if(u(e)){var n=this._annotations.get(t);[].concat(e).forEach((function(t){var e=t.timestamp;n.has(e)&&(i=!0,n.delete(e))})),0===n.size&&this._annotations.delete(t),i&&this.createVisibleAnnotations()}else i=!0,this._annotations.delete(t),this._visibleAnnotations.delete(t)}else i=!0,this._annotations.clear(),this._visibleAnnotations.clear();i&&this._chartStore.invalidate(qt)}},{key:"isEmpty",value:function(){return 0===this._visibleAnnotations.size}}]),t}(),le=function(){function t(i){e(this,t),this._chartStore=i,this._tags=new Map}return n(t,[{key:"_getById",value:function(t,e){var i=this.get(e);return i?i.get(t):null}},{key:"has",value:function(t,e){return!!this._getById(t,e)}},{key:"update",value:function(t,e,i){var n=this._getById(t,e);return!!n&&n.update(i)}},{key:"get",value:function(t){return this._tags.get(t)}},{key:"add",value:function(t,e){this._tags.has(e)||this._tags.set(e,new Map);var i=this._tags.get(e);t.forEach((function(t){i.set(t.id(),t)})),this._chartStore.invalidate(qt)}},{key:"remove",value:function(t,e){var i=!1;if(u(t)){if(this._tags.has(t))if(u(e)){var n=this._tags.get(t);[].concat(e).forEach((function(t){n.has(t)&&(i=!0,n.delete(t))})),0===n.size&&this._tags.delete(t)}else i=!0,this._tags.delete(t)}else i=!0,this._tags.clear();i&&this._chartStore.invalidate(qt)}}]),t}();function ue(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function fe(t){for(var e=1;arguments.length>e;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ue(Object(i),!0).forEach((function(e){mt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ue(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var de=function(){function t(i){e(this,t),this._chartStore=i,this._crosshair={}}return n(t,[{key:"set",value:function(t,e){var i,n,r=this._chartStore.dataList(),a=t||{},o=r[n=u(a.x)?0>(i=this._chartStore.timeScaleStore().coordinateToDataIndex(a.x))?0:i>r.length-1?r.length-1:i:i=r.length-1],s=this._chartStore.timeScaleStore().dataIndexToCoordinate(i),c=this._crosshair.x,h=this._crosshair.y,l=this._crosshair.paneId;this._crosshair=fe(fe({},a),{},{realX:s,kLineData:o,realDataIndex:i,dataIndex:n}),o&&this._chartStore.crosshairChange(this._crosshair),c===a.x&&h===a.y&&l===a.paneId||e||this._chartStore.invalidate(qt)}},{key:"recalculate",value:function(t){this.set(this._crosshair,t)}},{key:"get",value:function(){return this._crosshair}}]),t}(),ve=function(){function t(){e(this,t),this._observers=[]}return n(t,[{key:"subscribe",value:function(t){0>this._observers.indexOf(t)&&this._observers.push(t)}},{key:"unsubscribe",value:function(t){var e=this._observers.indexOf(t);e>-1?this._observers.splice(e,1):this._observers=[]}},{key:"execute",value:function(t){this._observers.forEach((function(e){e(t)}))}},{key:"hasObservers",value:function(){return this._observers.length>0}}]),t}(),_e=function(){function t(){e(this,t),this._delegates=new Map}return n(t,[{key:"execute",value:function(t,e){this.has(t)&&this._delegates.get(t).execute(e)}},{key:"has",value:function(t){return this._delegates.has(t)&&this._delegates.get(t).hasObservers()}},{key:"subscribe",value:function(t,e){this._delegates.has(t)||this._delegates.set(t,new ve),this._delegates.get(t).subscribe(e)}},{key:"unsubscribe",value:function(t,e){if(q(t)){var i=this._delegates.get(t);i&&(i.unsubscribe(e),i.hasObservers()||this._delegates.delete(t))}}}]),t}(),pe=function(){function t(i,n){e(this,t),this._handler=n,this._styleOptions=o(V),a(this._styleOptions,i),this._pricePrecision=2,this._volumePrecision=0,this._dataList=[],this._visibleDataList=[],this._dragPaneFlag=!1,this._timeScaleStore=new J(this),this._technicalIndicatorStore=new yt(this),this._shapeStore=new ae(this),this._annotationStore=new he(this),this._tagStore=new le(this),this._crosshairStore=new de(this),this._actionStore=new _e}return n(t,[{key:"adjustVisibleDataList",value:function(){this._visibleDataList=[];for(var t=this._timeScaleStore.from(),e=this._timeScaleStore.to(),i=t;e>i;i++){var n=this._dataList[i],r=this._timeScaleStore.dataIndexToCoordinate(i);this._visibleDataList.push({index:i,x:r,data:n})}this._annotationStore.createVisibleAnnotations()}},{key:"styleOptions",value:function(){return this._styleOptions}},{key:"applyStyleOptions",value:function(t){a(this._styleOptions,t)}},{key:"pricePrecision",value:function(){return this._pricePrecision}},{key:"volumePrecision",value:function(){return this._volumePrecision}},{key:"setPriceVolumePrecision",value:function(t,e){this._pricePrecision=t,this._volumePrecision=e,this._technicalIndicatorStore.setSeriesPrecision(t,e)}},{key:"dataList",value:function(){return this._dataList}},{key:"visibleDataList",value:function(){return this._visibleDataList}},{key:"addData",value:function(t,e,i){if(h(t)){if(s(t)){this._timeScaleStore.setLoading(!1),this._timeScaleStore.setMore(!f(i)||i);var n=0===this._dataList.length;this._dataList=t.concat(this._dataList),n&&this._timeScaleStore.resetOffsetRightSpace(),this._timeScaleStore.adjustFromTo()}else{if(e<this._dataList.length)this._dataList[e]=t,this.adjustVisibleDataList();else{this._dataList.push(t);var r=this._timeScaleStore.offsetRightBarCount();0>r&&this._timeScaleStore.setOffsetRightBarCount(--r),this._timeScaleStore.adjustFromTo()}}this._crosshairStore.recalculate(!0)}}},{key:"clearDataList",value:function(){this._dataList=[],this._visibleDataList=[],this._timeScaleStore.clear()}},{key:"timeScaleStore",value:function(){return this._timeScaleStore}},{key:"technicalIndicatorStore",value:function(){return this._technicalIndicatorStore}},{key:"shapeStore",value:function(){return this._shapeStore}},{key:"annotationStore",value:function(){return this._annotationStore}},{key:"tagStore",value:function(){return this._tagStore}},{key:"crosshairStore",value:function(){return this._crosshairStore}},{key:"actionStore",value:function(){return this._actionStore}},{key:"invalidate",value:function(t){this._handler.invalidate(t)}},{key:"crosshairChange",value:function(t){this._handler.crosshair(t)}},{key:"dragPaneFlag",value:function(){return this._dragPaneFlag}},{key:"setDragPaneFlag",value:function(t){this._dragPaneFlag=t}}]),t}();function ye(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=it(t)););return t}function me(){return me="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=ye(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(3>arguments.length?t:i):r.value}},me.apply(this,arguments)}function ge(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=document.createElement(t);for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i.style[n]=e[n]);return i}var xe="content",Se="yAxis",ke=function(){function t(i){e(this,t),this._height=-1,this._container=i.container,this._chartStore=i.chartStore,this._initBefore(i),this._initElement(),this._mainWidget=this._createMainWidget(this._element,i),this._yAxisWidget=this._createYAxisWidget(this._element,i)}return n(t,[{key:"_initBefore",value:function(t){}},{key:"_initElement",value:function(){this._element=ge("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"});var t=this._container.lastChild;t?this._container.insertBefore(this._element,t):this._container.appendChild(this._element)}},{key:"_createMainWidget",value:function(t,e){}},{key:"_createYAxisWidget",value:function(t,e){}},{key:"container",value:function(t){switch(t){case xe:return this._mainWidget.container();case Se:return this._yAxisWidget.container();default:return this._element}}},{key:"width",value:function(){return this._element.offsetWidth}},{key:"setWidth",value:function(t,e){this._mainWidget.setWidth(t),this._yAxisWidget&&this._yAxisWidget.setWidth(e)}},{key:"height",value:function(){return this._height}},{key:"setHeight",value:function(t){this._height=t,this._mainWidget.setHeight(t),this._yAxisWidget&&this._yAxisWidget.setHeight(t)}},{key:"setOffsetLeft",value:function(t,e){this._mainWidget.setOffsetLeft(t),this._yAxisWidget&&this._yAxisWidget.setOffsetLeft(e)}},{key:"layout",value:function(){this._element.offsetHeight!==this._height&&(this._element.style.height="".concat(this._height,"px")),this._mainWidget.layout(),this._yAxisWidget&&this._yAxisWidget.layout()}},{key:"invalidate",value:function(t){this._yAxisWidget&&this._yAxisWidget.invalidate(t),this._mainWidget.invalidate(t)}},{key:"createHtml",value:function(t){var e=t.id,i=t.content,n=t.style;return t.position===Se?this._yAxisWidget&&this._yAxisWidget.createHtml({id:e,content:i,style:n}):this._mainWidget.createHtml({id:e,content:i,style:n})}},{key:"removeHtml",value:function(t){this._yAxisWidget&&this._yAxisWidget.removeHtml(t),this._mainWidget.removeHtml(t)}},{key:"getImage",value:function(t){var e=this._element.offsetWidth,i=this._element.offsetHeight,n=ge("canvas",{width:"".concat(e,"px"),height:"".concat(i,"px"),boxSizing:"border-box"}),r=n.getContext("2d"),a=It(n);n.width=e*a,n.height=i*a,r.scale(a,a);var o=this._mainWidget.getElement(),s=o.offsetWidth,c=o.offsetHeight,h=parseInt(o.style.left,10);if(r.drawImage(this._mainWidget.getImage(t),h,0,s,c),this._yAxisWidget){var l=this._yAxisWidget.getElement(),u=l.offsetWidth,f=l.offsetHeight,d=parseInt(l.style.left,10);r.drawImage(this._yAxisWidget.getImage(t),d,0,u,f)}return n}},{key:"destroy",value:function(){this._container.removeChild(this._element)}}]),t}();function be(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}var we=function(){function t(i){e(this,t),this._width=0,this._height=0,this._initElement(i.container),this._mainView=this._createMainView(this._element,i),this._overlayView=this._createOverlayView(this._element,i),this._htmlBaseId=0,this._htmls=new Map}return n(t,[{key:"_initElement",value:function(t){this._element=ge("div",{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box"}),t.appendChild(this._element)}},{key:"_createMainView",value:function(t,e){}},{key:"_createOverlayView",value:function(t,e){}},{key:"container",value:function(){return this._element}},{key:"createHtml",value:function(t){var e=t.id,i=t.content,n=t.style,r=ge("div",function(t){for(var e=1;arguments.length>e;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?be(Object(i),!0).forEach((function(e){mt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):be(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({boxSizing:"border-box",position:"absolute",zIndex:12},void 0===n?{}:n));if(d(i)){var a=i.replace(/(^\s*)|(\s*$)/g,"");r.innerHTML=a}else r.appendChild(i);var o=e||"html_".concat(++this._htmlBaseId);return this._htmls.has(o)?this._element.replaceChild(r,this._htmls.get(o)):this._element.appendChild(r),this._htmls.set(o,r),o}},{key:"removeHtml",value:function(t){var e=this;t?[].concat(t).forEach((function(t){var i=e._htmls.get(t);i&&(e._element.removeChild(i),e._htmls.delete(t))})):(this._htmls.forEach((function(t){e._element.removeChild(t)})),this._htmls.clear())}},{key:"getElement",value:function(){return this._element}},{key:"setWidth",value:function(t){this._width=t,this._mainView.setWidth(t),this._overlayView.setWidth(t)}},{key:"setHeight",value:function(t){this._height=t,this._mainView.setHeight(t),this._overlayView.setHeight(t)}},{key:"setOffsetLeft",value:function(t){this._element.style.left="".concat(t,"px")}},{key:"layout",value:function(){this._element.offsetWidth!==this._width&&(this._element.style.width="".concat(this._width,"px")),this._element.offsetHeight!==this._height&&(this._element.style.height="".concat(this._height,"px")),this._mainView.layout(),this._overlayView.layout()}},{key:"invalidate",value:function(t){switch(t){case qt:this._overlayView.flush();break;case Jt:case Qt:this._mainView.flush(),this._overlayView.flush()}}},{key:"getImage",value:function(t){var e=ge("canvas",{width:"".concat(this._width,"px"),height:"".concat(this._height,"px"),boxSizing:"border-box"}),i=e.getContext("2d"),n=It(e);return e.width=this._width*n,e.height=this._height*n,i.scale(n,n),i.drawImage(this._mainView.getImage(),0,0,this._width,this._height),t&&this._overlayView&&i.drawImage(this._overlayView.getImage(),0,0,this._width,this._height),e}}]),t}();function Ee(t){return window.requestAnimationFrame?window.requestAnimationFrame(t):window.setTimeout(t,20)}function Pe(t){window.cancelAnimationFrame||clearTimeout(t),window.cancelAnimationFrame(t)}var Ae=function(){function t(i,n){e(this,t),this._chartStore=n,this._initCanvas(i)}return n(t,[{key:"_initCanvas",value:function(t){this._canvas=ge("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"}),this._ctx=this._canvas.getContext("2d"),t.appendChild(this._canvas)}},{key:"_redraw",value:function(t){this._ctx.clearRect(0,0,this._canvas.offsetWidth,this._canvas.offsetHeight),t&&t(),this._draw()}},{key:"_draw",value:function(){}},{key:"setWidth",value:function(t){this._width=t}},{key:"setHeight",value:function(t){this._height=t}},{key:"layout",value:function(){var t=this;this._height!==this._canvas.offsetHeight||this._width!==this._canvas.offsetWidth?this._redraw((function(){var e=It(t._canvas);t._canvas.style.width="".concat(t._width,"px"),t._canvas.style.height="".concat(t._height,"px"),t._canvas.width=Math.floor(t._width*e),t._canvas.height=Math.floor(t._height*e),t._ctx.scale(e,e)})):this.flush()}},{key:"flush",value:function(){var t=this;this.requestAnimationId&&(Pe(this.requestAnimationId),this.requestAnimationId=null),this.requestAnimationId=Ee((function(){t._redraw()}))}},{key:"getImage",value:function(){return this._canvas}}]),t}();function Ce(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var Te=function(t){tt(r,t);var i=Ce(r);function r(t,n,a,o,s){var c;return e(this,r),(c=i.call(this,t,n))._xAxis=a,c._yAxis=o,c._paneId=s,c}return n(r,[{key:"_draw",value:function(){this._ctx.globalCompositeOperation="destination-over",this._drawContent()}},{key:"_drawContent",value:function(){this._drawTechs(),this._drawGrid()}},{key:"_drawGrid",value:function(){var t=this,e=this._chartStore.styleOptions().grid;if(e.show){var i=e.horizontal;this._ctx.save(),i.show&&(this._ctx.strokeStyle=i.color,this._ctx.lineWidth=i.size,this._ctx.setLineDash(i.style===p?i.dashValue:[]),this._yAxis.ticks().forEach((function(e){At(t._ctx,e.y,0,t._width)})));var n=e.vertical;n.show&&(this._ctx.strokeStyle=n.color,this._ctx.lineWidth=n.size,this._ctx.setLineDash(n.style===p?n.dashValue:[]),this._xAxis.ticks().forEach((function(e){Ct(t._ctx,e.x,0,t._height)}))),this._ctx.restore()}}},{key:"_drawTechs",value:function(){var t=this;this._ctx.globalCompositeOperation="source-over";var e=this._chartStore.timeScaleStore().to(),i=this._chartStore.styleOptions().technicalIndicator;this._chartStore.technicalIndicatorStore().instances(this._paneId).forEach((function(n){var r=n.plots,a=[],o=t._chartStore.dataList(),s=n.result,c=n.styles||i;n.render&&(t._ctx.save(),n.render({ctx:t._ctx,dataSource:{from:t._chartStore.timeScaleStore().from(),to:e,kLineDataList:t._chartStore.dataList(),technicalIndicatorDataList:s},viewport:{width:t._width,height:t._height,dataSpace:t._chartStore.timeScaleStore().dataSpace(),barSpace:t._chartStore.timeScaleStore().barSpace()},styles:c,xAxis:t._xAxis,yAxis:t._yAxis}),t._ctx.restore());var h=c.line.colors||[],l=h.length,f=[],d=[],v=t._yAxis.isCandleYAxis();t._ctx.lineWidth=1,t._drawGraphics((function(i,_,p,y,m){var g=s[_]||{},x=0;n.shouldOhlc&&!v&&t._drawCandleBar(i,y,m,p,c.bar,A),r.forEach((function(n){var r=g[n.key],v=t._yAxis.convertToPixel(r);switch(n.type){case lt:if(u(r)){var p=ft(o,s,_,n,c,{color:c.circle.noChangeColor,isStroke:!0});t._drawCircle({x:i,y:v,radius:y,color:p.color,isStroke:p.isStroke})}break;case ht:if(u(r)){var m;m=u(n.baseValue)?n.baseValue:t._yAxis.min();var S=t._yAxis.convertToPixel(m),k=Math.abs(S-v),b={x:i-y,width:2*y,height:Math.max(1,k)};b.y=v>S?S:1>k?S-1:v;var w=ft(o,s,_,n,c,{color:c.bar.noChangeColor});b.color=w.color,b.isStroke=w.isStroke,t._drawBar(b)}break;case ct:var E=null;if(u(r)){E=ft(o,s,_,n,c,{color:h[x%l]});var P={x:i,y:v},A=f[x];d[x]||(d[x]=[]),d[x].push(P),A&&(A.color!==E.color||A.isDashed!==E.isDashed)&&(a.push({color:A.color,isDashed:A.isDashed,coordinates:d[x]}),d[x]=[P]),_===e-1&&a.push({color:E.color,isDashed:E.isDashed,coordinates:d[x]})}f[x]=E,x++}}))}),(function(){t._drawLines(a,c)}))})),this._ctx.globalCompositeOperation="destination-over"}},{key:"_drawGraphics",value:function(t,e){var i=this._chartStore.visibleDataList(),n=this._chartStore.timeScaleStore().barSpace(),r=this._chartStore.timeScaleStore().halfBarSpace();i.forEach((function(e,i){t(e.x,e.index,e.data,r,n,i)})),e&&e()}},{key:"_drawLines",value:function(t,e){var i=this;this._ctx.lineWidth=e.line.size,t.forEach((function(t){i._ctx.strokeStyle=t.color,i._ctx.setLineDash(t.isDashed?e.line.dashValue:[]),Tt(i._ctx,t.coordinates)}))}},{key:"_drawBar",value:function(t){t.isStroke?(this._ctx.strokeStyle=t.color,this._ctx.strokeRect(t.x+.5,t.y,t.width-1,t.height)):(this._ctx.fillStyle=t.color,this._ctx.fillRect(t.x,t.y,t.width,t.height))}},{key:"_drawCircle",value:function(t){this._ctx.strokeStyle=t.color,this._ctx.fillStyle=t.color,this._ctx.beginPath(),this._ctx.arc(t.x,t.y,t.radius,2*Math.PI,0,!0),t.isStroke?this._ctx.stroke():this._ctx.fill(),this._ctx.closePath()}},{key:"_drawCandleBar",value:function(t,e,i,n,r,a){var o=n.open,s=n.close,c=n.high,h=n.low;s>o?(this._ctx.strokeStyle=r.upColor,this._ctx.fillStyle=r.upColor):o>s?(this._ctx.strokeStyle=r.downColor,this._ctx.fillStyle=r.downColor):(this._ctx.strokeStyle=r.noChangeColor,this._ctx.fillStyle=r.noChangeColor);var l=this._yAxis.convertToPixel(o),u=this._yAxis.convertToPixel(s),f=[l,u,this._yAxis.convertToPixel(c),this._yAxis.convertToPixel(h)];f.sort((function(t,e){return t-e})),this._ctx.fillRect(t-.5,f[0],1,f[1]-f[0]),this._ctx.fillRect(t-.5,f[2],1,f[3]-f[2]);var d=Math.max(1,f[2]-f[1]);switch(a){case b:this._ctx.fillRect(t-e,f[1],i,d);break;case w:this._ctx.strokeRect(t-e+.5,f[1],i-1,d);break;case E:s>o?this._ctx.strokeRect(t-e+.5,f[1],i-1,d):this._ctx.fillRect(t-e,f[1],i,d);break;case P:s>o?this._ctx.fillRect(t-e,f[1],i,d):this._ctx.strokeRect(t-e+.5,f[1],i-1,d);break;default:this._ctx.fillRect(t-.5,f[0],1,f[3]-f[0]),this._ctx.fillRect(t-e,l,e,1),this._ctx.fillRect(t,u,e,1)}}}]),r}(Ae);function Ie(t,e,i,n,r){t.fillStyle=e,t.fillText(r,i,n)}function Oe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var De=function(t){tt(r,t);var i=Oe(r);function r(t,n,a,o,s){var c;return e(this,r),(c=i.call(this,t,n))._xAxis=a,c._yAxis=o,c._paneId=s,c}return n(r,[{key:"_draw",value:function(){this._ctx.textBaseline="alphabetic",this._drawTag(),this._drawShape(),this._drawAnnotation();var t=this._chartStore.crosshairStore().get();if(t.kLineData){var e=this._chartStore.styleOptions().crosshair;t.paneId===this._paneId&&this._drawCrosshairLine(e,"horizontal",t.y,0,this._width,At),t.paneId&&this._drawCrosshairLine(e,"vertical",t.realX,0,this._height,Ct),this._drawTooltip(t,this._chartStore.technicalIndicatorStore().instances(this._paneId))}}},{key:"_drawAnnotation",value:function(){var t=this,e=this._chartStore.annotationStore().get(this._paneId);e&&e.forEach((function(e){e.draw(t._ctx)}))}},{key:"_drawTag",value:function(){var t=this,e=this._chartStore.tagStore().get(this._paneId);e&&e.forEach((function(e){e.drawMarkLine(t._ctx)}))}},{key:"_drawShape",value:function(){var t=this;this._chartStore.shapeStore().instances(this._paneId).forEach((function(e){e.draw(t._ctx)}));var e=this._chartStore.shapeStore().progressInstance();e.paneId===this._paneId&&e.instance.draw(this._ctx)}},{key:"_drawTooltip",value:function(t,e){var i=this._chartStore.styleOptions().technicalIndicator;this._drawBatchTechToolTip(t,e,i,0,this._shouldDrawTooltip(t,i.tooltip))}},{key:"_drawCrosshairLine",value:function(t,e,i,n,r,a){var o=t[e],s=o.line;t.show&&o.show&&s.show&&(this._ctx.save(),this._ctx.lineWidth=s.size,this._ctx.strokeStyle=s.color,s.style===p&&this._ctx.setLineDash(s.dashValue),a(this._ctx,i,n,r),this._ctx.restore())}},{key:"_drawBatchTechToolTip",value:function(t,e,i){var n=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0;if(!a)return 0;var o=i.tooltip,s=r,c=s;return e.forEach((function(e){s+=o.text.marginTop+n._drawTechTooltip(t,e,i,s)+o.text.marginBottom})),s-c}},{key:"_drawTechTooltip",value:function(t,e,i){var n=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=i.tooltip,o=a.text,s=o.marginLeft,c=o.marginRight,h=o.size,l=o.color,u=0,f=o.marginTop+r,d=h,v=this._getTechTooltipData(t,e,i);if(this._ctx.textBaseline="top",this._ctx.font=Dt(h,o.weight,o.family),a.showName){var _=v.name,p=Ot(this._ctx,_);Ie(this._ctx,l,u+=s,f,_),u+=p,a.showParams||(u+=c)}if(a.showParams){var y=v.calcParamText,m=Ot(this._ctx,y);a.showName||(u+=s),Ie(this._ctx,l,u,f,y),u+=m+c}return v.values.forEach((function(t){u+=s;var e="".concat(t.title).concat(t.value),i=Ot(n._ctx,e);u+i>n._width&&(u=s,d+=h+1,f+=h+1),Ie(n._ctx,t.color||o.color,u,f,e),u+=i+c})),d}},{key:"_shouldDrawTooltip",value:function(t,e){var i=e.showRule;return i===T||i===I&&!!t.paneId}},{key:"_getTechTooltipData",value:function(t,e,i){var n=this._chartStore.dataList(),r=e.result,a="",o=e.calcParams;if(o.length>0){var s=o.map((function(t){return h(t)?t.value:t}));a="(".concat(s.join(","),")")}var l=[];if(c(e.createToolTipDataSource))l=e.createToolTipDataSource({dataSource:{from:this._chartStore.timeScaleStore().from(),to:this._chartStore.timeScaleStore().to(),kLineDataList:this._chartStore.dataList(),technicalIndicatorDataList:r},viewport:{width:this._width,height:this._height,dataSpace:this._chartStore.timeScaleStore().dataSpace(),barSpace:this._chartStore.timeScaleStore().barSpace()},crosshair:t,technicalIndicator:e,xAxis:this._xAxis,yAxis:this._yAxis,defaultStyles:i})||[];else{var f=e.styles||i,d=r[t.dataIndex],v=e.precision,_=e.shouldFormatBigNumber,p=f.line.colors||[],y=p.length,m=0;e.plots.forEach((function(e){var a={};switch(e.type){case lt:a={color:f.circle.noChangeColor};break;case ht:a={color:f.bar.noChangeColor};break;case ct:a={color:p[m%y]||i.tooltip.text.color},m++}var o=ft(n,r,t.dataIndex,e,f,a),s={};if(u(e.title)){var c=(d||{})[e.key];u(c)&&(c=N(c,v),_&&(c=X(c))),s.title=e.title,s.value=c||i.tooltip.defaultValue,s.color=o.color,l.push(s)}}))}return{values:l,name:e.shortName,calcParamText:a}}}]),r}(Ae);function Me(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var Le=function(t){tt(r,t);var i=Me(r);function r(){return e(this,r),i.apply(this,arguments)}return n(r,[{key:"_createMainView",value:function(t,e){return new Te(t,e.chartStore,e.xAxis,e.yAxis,e.paneId)}},{key:"_createOverlayView",value:function(t,e){return new De(t,e.chartStore,e.xAxis,e.yAxis,e.paneId)}}]),r}(we);function Re(t,e,i,n,r,a,o,s,c){Be(t,e,r,a,o,s,c),Fe(t,i,n,r,a,o,s,c)}function Fe(t,e,i,n,r,a,o,s){t.lineWidth=i,t.strokeStyle=e,ze(t,n,r,a,o,s),t.stroke()}function Be(t,e,i,n,r,a,o){t.fillStyle=e,ze(t,i,n,r,a,o),t.fill()}function ze(t,e,i,n,r,a){t.beginPath(),t.moveTo(e+a,i),t.arcTo(e+n,i,e+n,i+r,a),t.arcTo(e+n,i+r,e,i+r,a),t.arcTo(e,i+r,e,i,a),t.arcTo(e,i,e+n,i,a),t.closePath()}function He(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function je(t){for(var e=1;arguments.length>e;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?He(Object(i),!0).forEach((function(e){mt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):He(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Ve(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var Ye=function(t){tt(r,t);var i=Ve(r);function r(t,n,a,o){var s;return e(this,r),(s=i.call(this,t,n))._yAxis=a,s._paneId=o,s}return n(r,[{key:"_draw",value:function(){var t=this._chartStore.styleOptions().yAxis;t.show&&(this._drawAxisLine(t),this._drawTickLines(t),this._drawTickLabels(t),this._drawTechLastValue(),this._drawLastPriceLabel())}},{key:"_drawAxisLine",value:function(t){var e,i=t.axisLine;i.show&&(this._ctx.strokeStyle=i.color,this._ctx.lineWidth=i.size,e=this._yAxis.isFromYAxisZero()?0:this._width-1,Ct(this._ctx,e,0,this._height))}},{key:"_drawTickLines",value:function(t){var e=this,i=t.tickLine;if(i.show){this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color;var n,r,a=i.length;this._yAxis.isFromYAxisZero()?(n=0,t.axisLine.show&&(n+=t.axisLine.size),r=n+a):(n=this._width,t.axisLine.show&&(n-=t.axisLine.size),r=n-a),this._yAxis.ticks().forEach((function(t){At(e._ctx,t.y,n,r)}))}}},{key:"_drawTickLabels",value:function(t){var e=this,i=t.tickText;if(i.show){var n,r=t.tickLine,a=r.show,o=r.length;this._yAxis.isFromYAxisZero()?(n=i.paddingLeft,t.axisLine.show&&(n+=t.axisLine.size),a&&(n+=o),this._ctx.textAlign="left"):(n=this._width-i.paddingRight,t.axisLine.show&&(n-=t.axisLine.size),a&&(n-=o),this._ctx.textAlign="right"),this._ctx.textBaseline="middle",this._ctx.font=Dt(i.size,i.weight,i.family),this._ctx.fillStyle=i.color,this._yAxis.ticks().forEach((function(t){e._ctx.fillText(t.v,n,t.y)})),this._ctx.textAlign="left"}}},{key:"_drawTechLastValue",value:function(){var t=this,e=this._chartStore.styleOptions().technicalIndicator,i=e.lastValueMark;if(i.show&&i.text.show){var n=this._chartStore.technicalIndicatorStore().instances(this._paneId),r=this._chartStore.dataList();n.forEach((function(n){var a=n.result||[],o=a.length,s=a[o-1]||{},c={prev:{kLineData:r[o-2],technicalIndicatorData:a[o-2]},current:{kLineData:r[o-1],technicalIndicatorData:s},next:{kLineData:null,technicalIndicatorData:null}},h=n.precision,l=n.styles||e,f=l.line.colors||[],d=f.length,v=0;n.plots.forEach((function(e){var r,a=s[e.key];switch(e.type){case lt:r=e.color&&e.color(c,l)||l.circle.noChangeColor;break;case ht:r=e.color&&e.color(c,l)||l.bar.noChangeColor;break;case ct:r=f[v%d],v++}u(a)&&t._drawMarkLabel(a,h,n.shouldFormatBigNumber,je(je({},i.text),{},{backgroundColor:r}))}))}))}}},{key:"_drawLastPriceLabel",value:function(){if(this._yAxis.isCandleYAxis()){var t=this._chartStore.styleOptions().candle.priceMark,e=t.last;if(t.show&&e.show&&e.text.show){var i=this._chartStore.dataList(),n=i[i.length-1];if(n){var r,a=n.close,o=n.open;r=a>o?e.upColor:o>a?e.downColor:e.noChangeColor,this._drawMarkLabel(a,this._chartStore.pricePrecision(),!1,je(je({},e.text),{},{backgroundColor:r}))}}}}},{key:"_drawMarkLabel",value:function(t,e,i,n){var r,a=n.size,o=n.weight,s=n.family,c=n.color,h=n.backgroundColor,l=n.borderRadius,u=n.paddingLeft,f=n.paddingTop,d=n.paddingRight,v=n.paddingBottom,_=this._yAxis.convertToNicePixel(t);if(this._yAxis.yAxisType()===S){var p=((this._chartStore.visibleDataList()[0]||{}).data||{}).close;r="".concat(((t-p)/p*100).toFixed(2),"%")}else r=N(t,e),i&&(r=X(r));this._ctx.font=Dt(a,o,s);var y,m=Ot(this._ctx,r)+u+d,g=f+a+v;y=this._yAxis.isFromYAxisZero()?0:this._width-m,Be(this._ctx,h,y,_-f-a/2,m,g,l),this._ctx.textBaseline="middle",Ie(this._ctx,c,y+u,_,r)}}]),r}(Ae);function We(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var Ne=function(t){tt(r,t);var i=We(r);function r(t,n,a,o){var s;return e(this,r),(s=i.call(this,t,n))._yAxis=a,s._paneId=o,s}return n(r,[{key:"_draw",value:function(){this._ctx.textBaseline="middle",this._drawTag(),this._drawCrossHairLabel()}},{key:"_drawTag",value:function(){var t=this,e=this._chartStore.tagStore().get(this._paneId);e&&e.forEach((function(e){e.drawText(t._ctx)}))}},{key:"_drawCrossHairLabel",value:function(){var t=this._chartStore.crosshairStore().get();if(t.paneId===this._paneId&&0!==this._chartStore.dataList().length){var e=this._chartStore.styleOptions().crosshair,i=e.horizontal,n=i.text;if(e.show&&i.show&&n.show){var r,a,o=this._yAxis.convertFromPixel(t.y);if(this._yAxis.yAxisType()===S){var s=(this._chartStore.visibleDataList()[0]||{}).data||{};r="".concat(((o-s.close)/s.close*100).toFixed(2),"%")}else{var c=this._chartStore.technicalIndicatorStore().instances(this._paneId),h=0,l=!1;this._yAxis.isCandleYAxis()?h=this._chartStore.pricePrecision():c.forEach((function(t){h=Math.max(t.precision,h),l||(l=t.shouldFormatBigNumber)})),r=N(o,h),l&&(r=X(r))}var u=n.borderSize,f=Mt(this._ctx,r,n),d=Lt(n);a=this._yAxis.isFromYAxisZero()?0:this._width-f,Re(this._ctx,n.backgroundColor,n.borderColor,u,a,t.y-u-n.paddingTop-n.size/2,f,d,n.borderRadius),Ie(this._ctx,n.color,a+u+n.paddingLeft,t.y,r)}}}}]),r}(Ae);function Xe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var Ge=function(t){tt(r,t);var i=Xe(r);function r(){return e(this,r),i.apply(this,arguments)}return n(r,[{key:"_createMainView",value:function(t,e){return new Ye(t,e.chartStore,e.yAxis,e.paneId)}},{key:"_createOverlayView",value:function(t,e){return new Ne(t,e.chartStore,e.yAxis,e.paneId)}}]),r}(we),Ue=function(){function t(i){e(this,t),this._chartStore=i,this._width=0,this._height=0,this._cacheMinValue=0,this._cacheMaxValue=0,this._minValue=0,this._maxValue=0,this._range=0,this._realMinValue=0,this._realMaxValue=0,this._realRange=0,this._ticks=[],this._initMeasureCanvas()}return n(t,[{key:"_initMeasureCanvas",value:function(){var t=ge("canvas"),e=It(t);this._measureCtx=t.getContext("2d"),this._measureCtx.scale(e,e)}},{key:"min",value:function(){return this._minValue}},{key:"max",value:function(){return this._maxValue}},{key:"width",value:function(){return this._width}},{key:"height",value:function(){return this._height}},{key:"setWidth",value:function(t){this._width=t}},{key:"setHeight",value:function(t){this._height=t}},{key:"ticks",value:function(){return this._ticks}},{key:"computeAxis",value:function(t){var e=this._optimalMinMax(this._computeMinMax());return this._minValue=e.min,this._maxValue=e.max,this._range=e.range,this._realMinValue=e.realMin,this._realMaxValue=e.realMax,this._realRange=e.realRange,!(this._cacheMinValue===e.min&&this._cacheMaxValue===e.max&&!t)&&(this._cacheMinValue=e.min,this._cacheMaxValue=e.max,this._ticks=this._optimalTicks(this._computeTicks()),!0)}},{key:"_computeMinMax",value:function(){}},{key:"_optimalMinMax",value:function(t){}},{key:"_computeTicks",value:function(){var t=[];if(this._range>=0){var e=this._computeInterval(this._realRange),i=e.interval,n=e.precision,r=U(Math.ceil(this._realMinValue/i)*i,n),a=U(Math.floor(this._realMaxValue/i)*i,n),o=0,s=r;if(0!==i)for(;a>=s;)t[o]={v:s.toFixed(n)},++o,s+=i}return t}},{key:"_optimalTicks",value:function(t){}},{key:"_computeInterval",value:function(t){var e,i,n,r,a=(i=Math.floor(Z(e=t/8)),n=K(i),e=(1.5>(r=e/n)?1:2.5>r?2:3.5>r?3:4.5>r?4:5.5>r?5:6.5>r?6:8)*n,-20>i?e:+e.toFixed(0>i?-i:0)),o=function(t){var e=""+t,i=e.indexOf("e");if(i>0){var n=+e.slice(i+1);return 0>n?-n:0}var r=e.indexOf(".");return 0>r?0:e.length-1-r}(a);return{interval:a,precision:o}}}]),t}();function Ze(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var Ke=function(t){tt(r,t);var i=Ze(r);function r(t,n,a){var o;return e(this,r),(o=i.call(this,t))._isCandleYAxis=n,o._paneId=a,o}return n(r,[{key:"_computeMinMax",value:function(){var t,e=this,i=[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],n=[],r=!1,a=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER;this._chartStore.technicalIndicatorStore().instances(this._paneId).forEach((function(i){if(r||(r=i.shouldOhlc),s=Math.min(s,i.precision),l(i.minValue)&&(a=Math.min(a,i.minValue)),l(i.maxValue)&&(o=Math.max(o,i.maxValue)),i.styles){t||(t={top:0,bottom:0});var c=i.styles.margin;l(c.top)&&(t.top=Math.max(1>c.top?c.top:c.top/e._height,t.top)),l(c.bottom)&&(t.bottom=Math.max(1>c.bottom?c.bottom:c.bottom/e._height,t.bottom))}n.push({plots:i.plots,result:i.result})}));var c=4;if(this._isCandleYAxis){var h=this._chartStore.pricePrecision();c=s!==Number.MAX_SAFE_INTEGER?Math.min(s,h):h}else s!==Number.MAX_SAFE_INTEGER&&(c=s);var f=this._chartStore.visibleDataList(),d=this._chartStore.styleOptions().candle,v=d.type===C,_=d.area.value,p=this._isCandleYAxis&&!v||!this._isCandleYAxis&&r;return f.forEach((function(t){var r=t.index,a=t.data;p&&(i[0]=Math.min(i[0],a.low),i[1]=Math.max(i[1],a.high)),e._isCandleYAxis&&v&&(i[0]=Math.min(i[0],a[_]),i[1]=Math.max(i[1],a[_])),n.forEach((function(t){var e=t.result[r]||{};t.plots.forEach((function(t){var n=e[t.key];u(n)&&(i[0]=Math.min(i[0],n),i[1]=Math.max(i[1],n))}))}))})),i[0]!==Number.MAX_SAFE_INTEGER&&i[1]!==Number.MIN_SAFE_INTEGER?(i[0]=Math.min(a,i[0]),i[1]=Math.max(o,i[1])):(i[0]=0,i[1]=10),{min:i[0],max:i[1],precision:c,specifyMin:a,specifyMax:o,techGap:t}}},{key:"_optimalMinMax",value:function(t){var e,i,n=t.precision,r=t.specifyMin,a=t.specifyMax,o=t.techGap,s=t.min,c=t.max,h=this.yAxisType();switch(h){case S:var u=(this._chartStore.visibleDataList()[0]||{}).data||{};l(u.close)&&(s=(s-u.close)/u.close*100,c=(c-u.close)/u.close*100),e=.01;break;case k:s=Z(s),c=Z(c),e=.05*K(-n);break;default:e=K(-n)}if(s===c||e>Math.abs(s-c)){var f=r===s,d=a===c;s=f?s:d?s-8*e:s-4*e,c=d?c:f?c+8*e:c+4*e}var v,_=.2;l((i=this._isCandleYAxis?this._chartStore.styleOptions().candle.margin:o?{top:0,bottom:0}:this._chartStore.styleOptions().technicalIndicator.margin).top)&&(v=1>i.top?i.top:i.top/this._height,_=o?Math.max(o.top,v):v);var p,y=.1;l(i.bottom)&&(p=1>i.bottom?i.bottom:i.bottom/this._height,y=o?Math.max(o.bottom,p):p);var m,g,x,b=Math.abs(c-s);return b=Math.abs((c+=b*_)-(s-=b*y)),h===k?(m=K(s),g=K(c),x=Math.abs(g-m)):(m=s,g=c,x=b),{min:s,max:c,range:b,realMin:m,realMax:g,realRange:x}}},{key:"_optimalTicks",value:function(t){var e=this,i=[],n=this.yAxisType(),r=this._chartStore.technicalIndicatorStore().instances(this._paneId),a=0,o=!1;this._isCandleYAxis?a=this._chartStore.pricePrecision():r.forEach((function(t){a=Math.max(a,t.precision),o||(o=t.shouldFormatBigNumber)}));var s,c=this._chartStore.styleOptions().xAxis.tickText.size;return t.forEach((function(t){var r,h=t.v,l=e._innerConvertToPixel(+h);switch(n){case S:r="".concat(N(h,2),"%");break;case k:l=e._innerConvertToPixel(Z(h)),r=N(h,a);break;default:r=N(h,a),o&&(r=X(r))}l>c&&e._height-c>l&&(s&&Math.abs(s-l)>2*c||!s)&&(i.push({v:r,y:l}),s=l)})),i}},{key:"_innerConvertToPixel",value:function(t){var e=(t-this._minValue)/this._range;return this.isReverse()?Math.round(e*this._height):Math.round((1-e)*this._height)}},{key:"isCandleYAxis",value:function(){return this._isCandleYAxis}},{key:"yAxisType",value:function(){return this._isCandleYAxis?this._chartStore.styleOptions().yAxis.type:x}},{key:"isReverse",value:function(){return this._isCandleYAxis&&this._chartStore.styleOptions().yAxis.reverse}},{key:"isFromYAxisZero",value:function(){var t=this._chartStore.styleOptions().yAxis;return t.position===m&&t.inside||t.position===g&&!t.inside}},{key:"getSelfWidth",value:function(){var t=this,e=this._chartStore.styleOptions(),i=e.yAxis,n=i.width;if(l(n))return n;var r=0;if(i.show&&(i.axisLine.show&&(r+=i.axisLine.size),i.tickLine.show&&(r+=i.tickLine.length),i.tickText.show)){var a=0;this._measureCtx.font=Dt(i.tickText.size,i.tickText.weight,i.tickText.family),this._ticks.forEach((function(e){a=Math.max(a,Ot(t._measureCtx,e.v))})),r+=i.tickText.paddingLeft+i.tickText.paddingRight+a}var o=e.crosshair,s=0;if(o.show&&o.horizontal.show&&o.horizontal.text.show){var c=this._chartStore.technicalIndicatorStore().instances(this._paneId),h=0,u=!1;c.forEach((function(t){h=Math.max(t.precision,h),u||(u=t.shouldFormatBigNumber)})),this._measureCtx.font=Dt(o.horizontal.text.size,o.horizontal.text.weight,o.horizontal.text.family);var f=2;if(this.yAxisType()!==S)if(this._isCandleYAxis){var d=this._chartStore.pricePrecision(),v=e.technicalIndicator.lastValueMark;f=v.show&&v.text.show?Math.max(h,d):d}else f=h;var _=N(this._maxValue,f);u&&(_=X(_)),s+=o.horizontal.text.paddingLeft+o.horizontal.text.paddingRight+2*o.horizontal.text.borderSize+Ot(this._measureCtx,_)}return Math.max(r,s)}},{key:"convertFromPixel",value:function(t){var e=(this.isReverse()?t/this._height:1-t/this._height)*this._range+this._minValue;switch(this.yAxisType()){case S:var i=(this._chartStore.visibleDataList()[0]||{}).data||{};if(l(i.close))return i.close*e/100+i.close;break;case k:return K(e);default:return e}}},{key:"convertToPixel",value:function(t){var e;switch(this.yAxisType()){case S:var i=(this._chartStore.visibleDataList()[0]||{}).data||{};l(i.close)&&(e=(t-i.close)/i.close*100);break;case k:e=Z(t);break;default:e=t}return this._innerConvertToPixel(e)}},{key:"convertToNicePixel",value:function(t){var e=this.convertToPixel(t);return Math.round(Math.max(.05*this._height,Math.min(e,.98*this._height)))}}]),r}(Ue);function $e(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var qe=function(t){tt(r,t);var i=$e(r);function r(t){var n;return e(this,r),(n=i.call(this,t))._minHeight=30,n._initHeight(t),n}return n(r,[{key:"_initBefore",value:function(t){this._id=t.id,this._yAxis=this._createYAxis(t)}},{key:"_initHeight",value:function(t){var e=t.height,i=t.minHeight;if(u(i)&&this.setMinHeight(i),u(e)){var n=this.minHeight();this.setHeight(n>e?n:e)}}},{key:"_createYAxis",value:function(t){return new Ke(t.chartStore,!1,t.id)}},{key:"_createMainWidget",value:function(t,e){return new Le({container:t,chartStore:e.chartStore,xAxis:e.xAxis,yAxis:this._yAxis,paneId:e.id})}},{key:"_createYAxisWidget",value:function(t,e){return new Ge({container:t,chartStore:e.chartStore,yAxis:this._yAxis,paneId:e.id})}},{key:"minHeight",value:function(){return this._minHeight}},{key:"setMinHeight",value:function(t){this._minHeight=t}},{key:"setHeight",value:function(t){me(it(r.prototype),"setHeight",this).call(this,t),this._yAxis.setHeight(t)}},{key:"setWidth",value:function(t,e){me(it(r.prototype),"setWidth",this).call(this,t,e),this._yAxis.setWidth(e)}},{key:"id",value:function(){return this._id}},{key:"yAxis",value:function(){return this._yAxis}}]),r}(ke);function Je(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var Qe=function(t){tt(r,t);var i=Je(r);function r(){return e(this,r),i.apply(this,arguments)}return n(r,[{key:"_drawContent",value:function(){var t=this._chartStore.styleOptions().candle;this._drawLastPriceLine(t.priceMark),t.type===C?this._drawArea(t):(this._drawHighLowPrice(t.priceMark),this._drawCandle(t)),this._drawTechs(),this._drawGrid()}},{key:"_drawArea",value:function(t){var e=this,i=[],n=[],r=Number.MAX_SAFE_INTEGER,a=t.area;this._drawGraphics((function(t,o,s,c,h,u){var f=s[a.value];if(l(f)){var d=e._yAxis.convertToPixel(f);if(0===u){var v=t-c;n.push({x:v,y:e._height}),n.push({x:v,y:d}),i.push({x:v,y:d})}i.push({x:t,y:d}),n.push({x:t,y:d}),r=Math.min(r,d)}}),(function(){var t=n.length;if(t>0){var o=n[t-1],c=e._chartStore.timeScaleStore().halfBarSpace(),h=o.x+c;i.push({x:h,y:o.y}),n.push({x:h,y:o.y}),n.push({x:h,y:e._height})}if(i.length>0&&(e._ctx.lineWidth=a.lineSize,e._ctx.strokeStyle=a.lineColor,Tt(e._ctx,i)),n.length>0){var l=a.backgroundColor;if(s(l)){var u=e._ctx.createLinearGradient(0,e._height,0,r);try{l.forEach((function(t){u.addColorStop(t.offset,t.color)}))}catch(t){}e._ctx.fillStyle=u}else e._ctx.fillStyle=l;Pt(e._ctx,n)}}))}},{key:"_drawCandle",value:function(t){var e=this;this._drawGraphics((function(i,n,r,a,o){e._drawCandleBar(i,a,o,r,t.bar,t.type)}))}},{key:"_drawHighLowPrice",value:function(t){if(t.show&&(t.high.show||t.low.show)){var e={price:Number.MIN_SAFE_INTEGER,pos:-1},i={price:Number.MAX_SAFE_INTEGER,pos:-1};this._chartStore.visibleDataList().forEach((function(t){var n=t.index,r=t.data,a=Y(r,"high",Number.MIN_SAFE_INTEGER);a>e.price&&(e.price=a,e.pos=n);var o=Y(r,"low",Number.MAX_SAFE_INTEGER);i.price>o&&(i.price=o,i.pos=n)}));var n=this._yAxis.convertToPixel(e.price);e.y=n;var r=this._yAxis.convertToPixel(i.price);i.y=r;var a=[],o=[];r>n?(a=[-2,-5],o=[2,5]):(a=[2,5],o=[-2,-5]);var s=this._chartStore.pricePrecision();this._ctx.textAlign="left",this._ctx.lineWidth=1,this._ctx.textBaseline="middle",this._drawRealHighLowPrice(t.high,a,s,e),this._drawRealHighLowPrice(t.low,o,s,i)}}},{key:"_drawRealHighLowPrice",value:function(t,e,i,n){if(t.show){var r=n.price,a=n.y,o=this._xAxis.convertToPixel(n.pos),s=a+e[0];this._ctx.strokeStyle=t.color,this._ctx.fillStyle=t.color,Tt(this._ctx,[{x:o-2,y:s+e[0]},{x:o,y:s},{x:o+2,y:s+e[0]}]);var c=s+e[1];Tt(this._ctx,[{x:o,y:s},{x:o,y:c},{x:o+5,y:c}]),this._ctx.font=Dt(t.textSize,t.textWeight,t.textFamily);var h=N(r,i);this._ctx.fillText(h,o+5+t.textMargin,c)}}},{key:"_drawLastPriceLine",value:function(t){var e=t.last;if(t.show&&e.show&&e.line.show){var i=this._chartStore.dataList(),n=i[i.length-1];if(n){var r,a=n.close,o=n.open,s=this._yAxis.convertToNicePixel(a);r=a>o?e.upColor:o>a?e.downColor:e.noChangeColor,this._ctx.save(),this._ctx.strokeStyle=r,this._ctx.lineWidth=e.line.size,e.line.style===p&&this._ctx.setLineDash(e.line.dashValue),At(this._ctx,s,0,this._width),this._ctx.restore()}}}}]),r}(Te);function ti(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var ei=function(t){tt(r,t);var i=ti(r);function r(){return e(this,r),i.apply(this,arguments)}return n(r,[{key:"_drawTooltip",value:function(t,e){var i=this._chartStore.styleOptions(),n=i.candle,r=n.tooltip,a=i.technicalIndicator,o=a.tooltip,s=this._shouldDrawTooltip(t,r),c=this._shouldDrawTooltip(t,o);if(r.showType===O&&o.showType===O)this._drawCandleTooltipWithRect(t,e,n,s,a,0,c);else if(r.showType===D){var h=this._drawCandleTooltipWithStandard(t.kLineData,n,s);if(o.showType===D)this._drawBatchTechToolTip(t,e,a,s?h+r.text.marginTop:0,c);else this._drawCandleTooltipWithRect(t,e,n,!1,a,h,c)}else{var l=this._drawBatchTechToolTip(t,e,a,0,c);this._drawCandleTooltipWithRect(t,e,n,s,a,l,!1)}}},{key:"_drawCandleTooltipWithStandard",value:function(t,e,i){var n=this;if(!i)return 0;var r=this._getCandleTooltipData(t,e),a=e.tooltip,o=a.text.marginLeft,s=a.text.marginRight,c=a.text.size,l=a.text.color,u=a.labels;this._ctx.textBaseline="top",this._ctx.font=Dt(c,a.text.weight,a.text.family);var f=o,d=a.text.marginTop,v=c;return u.forEach((function(t,e){var i,u,_=Ot(n._ctx,t),p=r[e]||a.defaultValue;h(p)?(i=p.value||a.defaultValue,u=p.color||l):(u=l,i=p);var y=Ot(n._ctx,i);f+_+y>n._width&&(f=o,v+=c+1,d+=c+1),Ie(n._ctx,l,f,d,t),Ie(n._ctx,u,f+_,d,i),f+=_+y+o+s})),v}},{key:"_drawCandleTooltipWithRect",value:function(t,e,i,n,r,a,o){var s=this;if(n||o){var c=i.tooltip,l=c.labels,f=this._getCandleTooltipData(t.kLineData,i),d=c.text.marginLeft,v=c.text.marginRight,_=c.text.marginTop,p=c.text.marginBottom,y=c.text.size,x=c.text.color,S=c.rect,k=S.borderSize,b=S.paddingLeft,w=S.paddingRight,E=S.paddingTop,P=S.paddingBottom,A=S.offsetLeft,C=S.offsetRight,T=0,I=0,O=0;this._ctx.save(),this._ctx.textBaseline="top",n&&(this._ctx.font=Dt(y,c.text.weight,c.text.family),l.forEach((function(t,e){var i,n=f[e];i=h(n)?n.value||c.defaultValue:n;var r="".concat(t).concat(i),a=Ot(s._ctx,r)+d+v;T=Math.max(T,a)})),O+=(p+_+y)*l.length);var D=r.tooltip,M=D.text.marginLeft,L=D.text.marginRight,R=D.text.marginTop,F=D.text.marginBottom,B=D.text.size,z=[];if(e.forEach((function(e){z.push(s._getTechTooltipData(t,e,r))})),o&&(this._ctx.font=Dt(B,D.text.weight,D.text.family),z.forEach((function(t){t.values.forEach((function(t){var e=t.title,i=t.value;if(u(e)){var n="".concat(e).concat(i),r=Ot(s._ctx,n)+M+L;T=Math.max(T,r),O+=R+F+B}}))}))),0!==(I+=T)&&0!==O){I+=2*k+b+w,O+=2*k+E+P;var H,j=this._chartStore.styleOptions();this._width/2>t.realX?(H=this._width-C-I,j.yAxis.inside&&j.yAxis.position===g&&(H-=this._yAxis.width())):(H=A,j.yAxis.inside&&j.yAxis.position===m&&(H+=this._yAxis.width()));var V=a+S.offsetTop,Y=S.borderRadius;Be(this._ctx,S.backgroundColor,H,V,I,O,Y),Fe(this._ctx,S.borderColor,k,H,V,I,O,Y);var W=H+k+b+d,N=V+k+E;if(n&&(this._ctx.font=Dt(y,c.text.weight,c.text.family),l.forEach((function(t,e){N+=_,s._ctx.textAlign="left",Ie(s._ctx,x,W,N,t);var i,n,r=f[e];h(r)?(n=r.color||x,i=r.value||c.defaultValue):(n=x,i=r||c.defaultValue),s._ctx.textAlign="right",Ie(s._ctx,n,H+I-k-v-w,N,i),N+=y+p}))),o){var X=H+k+b+M;this._ctx.font=Dt(B,D.text.weight,D.text.family),z.forEach((function(t){t.values.forEach((function(t){N+=R,s._ctx.textAlign="left",s._ctx.fillStyle=t.color||D.text.color,s._ctx.fillText(t.title,X,N),s._ctx.textAlign="right",s._ctx.fillText(t.value,H+I-k-L-w,N),N+=B+F}))}))}this._ctx.restore()}}}},{key:"_getCandleTooltipData",value:function(t,e){var i=this,n=e.tooltip.values,r=[];if(n)c(n)?r=n(t,e)||[]:s(n)&&(r=n);else{var a=this._chartStore.pricePrecision(),o=this._chartStore.volumePrecision();(r=[Y(t,"timestamp"),Y(t,"open"),Y(t,"close"),Y(t,"high"),Y(t,"low"),Y(t,"volume")]).forEach((function(t,e){switch(e){case 0:r[e]=W(i._chartStore.timeScaleStore().dateTimeFormat(),t,"YYYY-MM-DD hh:mm");break;case r.length-1:r[e]=X(N(t,o));break;default:r[e]=N(t,a)}}))}return r}}]),r}(De);function ii(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var ni=function(t){tt(r,t);var i=ii(r);function r(){return e(this,r),i.apply(this,arguments)}return n(r,[{key:"_createMainView",value:function(t,e){return new Qe(t,e.chartStore,e.xAxis,e.yAxis,e.paneId)}},{key:"_createOverlayView",value:function(t,e){return new ei(t,e.chartStore,e.xAxis,e.yAxis,e.paneId)}}]),r}(Le);function ri(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var ai=function(t){tt(r,t);var i=ri(r);function r(){return e(this,r),i.apply(this,arguments)}return n(r,[{key:"_createYAxis",value:function(t){return new Ke(t.chartStore,!0,t.id)}},{key:"_createMainWidget",value:function(t,e){return new ni({container:t,chartStore:e.chartStore,xAxis:e.xAxis,yAxis:this._yAxis,paneId:e.id})}}]),r}(qe);function oi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var si=function(t){tt(r,t);var i=oi(r);function r(t,n,a){var o;return e(this,r),(o=i.call(this,t,n))._xAxis=a,o}return n(r,[{key:"_draw",value:function(){var t=this._chartStore.styleOptions().xAxis;t.show&&(this._drawAxisLine(t),this._drawTickLines(t),this._drawTickLabels(t))}},{key:"_drawAxisLine",value:function(t){var e=t.axisLine;e.show&&(this._ctx.strokeStyle=e.color,this._ctx.lineWidth=e.size,At(this._ctx,0,0,this._width))}},{key:"_drawTickLines",value:function(t){var e=this,i=t.tickLine;if(i.show){this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color;var n=t.axisLine.show?t.axisLine.size:0,r=n+i.length;this._xAxis.ticks().forEach((function(t){Ct(e._ctx,t.x,n,r)}))}}},{key:"_drawTickLabels",value:function(t){var e=t.tickText;if(e.show){var i=t.tickLine;this._ctx.textBaseline="top",this._ctx.font=Dt(e.size,e.weight,e.family),this._ctx.textAlign="center",this._ctx.fillStyle=e.color;var n=e.paddingTop;t.axisLine.show&&(n+=t.axisLine.size),i.show&&(n+=i.length);for(var r=this._xAxis.ticks(),a=r.length,o=0;a>o;o++)this._ctx.fillText(r[o].v,r[o].x,n)}}}]),r}(Ae);function ci(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var hi=function(t){tt(r,t);var i=ci(r);function r(t,n,a){var o;return e(this,r),(o=i.call(this,t,n))._xAxis=a,o}return n(r,[{key:"_draw",value:function(){this._drawCrosshairLabel()}},{key:"_drawCrosshairLabel",value:function(){var t=this._chartStore.crosshairStore().get();if(t.paneId){var e=this._chartStore.styleOptions().crosshair,i=e.vertical,n=i.text;if(e.show&&i.show&&n.show&&t.dataIndex===t.realDataIndex){var r=t.kLineData.timestamp,a=W(this._chartStore.timeScaleStore().dateTimeFormat(),r,"YYYY-MM-DD hh:mm"),o=n.paddingLeft,s=n.paddingRight,c=n.paddingTop,h=n.borderSize,l=Mt(this._ctx,a,n),u=Lt(n),f=l-2*h-o-s,d=t.realX-f/2;o+h>d?d=o+h:d>this._width-f-h-s&&(d=this._width-f-h-s),Re(this._ctx,n.backgroundColor,n.borderColor,h,d-h-o,0,l,u,n.borderRadius),this._ctx.textBaseline="top",Ie(this._ctx,n.color,d,h+c,a)}}}}]),r}(Ae);function li(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var ui=function(t){tt(r,t);var i=li(r);function r(){return e(this,r),i.apply(this,arguments)}return n(r,[{key:"_createMainView",value:function(t,e){return new si(t,e.chartStore,e.xAxis)}},{key:"_createOverlayView",value:function(t,e){return new hi(t,e.chartStore,e.xAxis)}}]),r}(we);function fi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var di=function(t){tt(r,t);var i=fi(r);function r(){return e(this,r),i.apply(this,arguments)}return n(r,[{key:"_computeMinMax",value:function(){return{min:this._chartStore.timeScaleStore().from(),max:this._chartStore.timeScaleStore().to()-1}}},{key:"_optimalMinMax",value:function(t){var e=t.min,i=t.max,n=i-e+1;return{min:e,max:i,range:n,realMin:e,realMax:i,realRange:n}}},{key:"_optimalTicks",value:function(t){var e=[],i=t.length,n=this._chartStore.dataList();if(i>0){var r=this._chartStore.timeScaleStore().dateTimeFormat(),a=this._chartStore.styleOptions().xAxis.tickText;this._measureCtx.font=Dt(a.size,a.weight,a.family);var o=Ot(this._measureCtx,"00-00 00:00"),s=this.convertToPixel(parseInt(t[0].v,10)),c=1;if(i>1){var h=this.convertToPixel(parseInt(t[1].v,10)),l=Math.abs(h-s);o>l&&(c=Math.ceil(o/l))}for(var u=0;i>u;u+=c){var f=parseInt(t[u].v,10),d=n[f].timestamp,v=W(r,d,"hh:mm");if(0!==u)v=this._optimalTickLabel(r,d,n[parseInt(t[u-c].v,10)].timestamp)||v;var _=this.convertToPixel(f);e.push({v:v,x:_,oV:d})}if(1===e.length)e[0].v=W(r,e[0].oV,"YYYY-MM-DD hh:mm");else{var p=e[0].oV,y=e[1].oV;if(e[2]){var m=e[2].v;/^[0-9]{2}-[0-9]{2}$/.test(m)?e[0].v=W(r,p,"MM-DD"):/^[0-9]{4}-[0-9]{2}$/.test(m)?e[0].v=W(r,p,"YYYY-MM"):/^[0-9]{4}$/.test(m)&&(e[0].v=W(r,p,"YYYY"))}else e[0].v=this._optimalTickLabel(r,p,y)||e[0].v}}return e}},{key:"_optimalTickLabel",value:function(t,e,i){var n=W(t,e,"YYYY"),r=W(t,e,"YYYY-MM"),a=W(t,e,"MM-DD");return n!==W(t,i,"YYYY")?n:r!==W(t,i,"YYYY-MM")?r:a!==W(t,i,"MM-DD")?a:null}},{key:"getSelfHeight",value:function(){var t=this._chartStore.styleOptions(),e=t.xAxis,i=e.height;if(l(i))return i;var n=t.crosshair,r=0;e.show&&(e.axisLine.show&&(r+=e.axisLine.size),e.tickLine.show&&(r+=e.tickLine.length),e.tickText.show&&(r+=e.tickText.paddingTop+e.tickText.paddingBottom+e.tickText.size));var a=0;return n.show&&n.vertical.show&&n.vertical.text.show&&(a+=n.vertical.text.paddingTop+n.vertical.text.paddingBottom+2*n.vertical.text.borderSize+n.vertical.text.size),Math.max(r,a)}},{key:"convertFromPixel",value:function(t){return this._chartStore.timeScaleStore().coordinateToDataIndex(t)}},{key:"convertToPixel",value:function(t){return this._chartStore.timeScaleStore().dataIndexToCoordinate(t)}}]),r}(Ue);function vi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var _i=function(t){tt(r,t);var i=vi(r);function r(){return e(this,r),i.apply(this,arguments)}return n(r,[{key:"_initBefore",value:function(){this._xAxis=new di(this._chartStore)}},{key:"_createMainWidget",value:function(t,e){return new ui({container:t,chartStore:e.chartStore,xAxis:this._xAxis})}},{key:"xAxis",value:function(){return this._xAxis}},{key:"setWidth",value:function(t,e){me(it(r.prototype),"setWidth",this).call(this,t,e),this._xAxis.setWidth(t)}},{key:"setHeight",value:function(t){me(it(r.prototype),"setHeight",this).call(this,t),this._xAxis.setHeight(t)}}]),r}(ke),pi=function(){function t(){e(this,t),this._baseId=1}return n(t,[{key:"next",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=(new Date).getTime();return e===this._prevIdTimestamp?++this._baseId:this._baseId=1,this._prevIdTimestamp=e,"".concat(t).concat(e,"_").concat(this._baseId)}}]),t}(),yi=new pi;function mi(t){return yi.next(t)}var gi="mouse",xi="touch";function Si(t){return t.type===xi}function ki(t){return t.type===gi}function bi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function wi(t){for(var e=1;arguments.length>e;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?bi(Object(i),!0).forEach((function(e){mt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):bi(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var Ei=0,Pi=2;function Ai(t){return t.getBoundingClientRect()||{left:0,top:0}}function Ci(t){return!!t.touches}function Ti(t){t.cancelable&&t.preventDefault()}function Ii(t,e){var i=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(i*i+n*n)}var Oi=function(){function t(i,n,r){e(this,t),this._target=i,this._handler=n,this._options=r,this._clickCount=0,this._clickTimeoutId=null,this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._moveExceededManhattanDistance=!1,this._cancelClick=!1,this._unsubscribeOutsideEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRoot=null,this._startPinchMiddleCoordinate=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventDragProcess=!1,this._mousePressed=!1,this._init()}return n(t,[{key:"setOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._options=wi(wi({},this.options),t)}},{key:"destroy",value:function(){null!==this._unsubscribeOutsideEvents&&(this._unsubscribeOutsideEvents(),this._unsubscribeOutsideEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),this._clearLongTapTimeout(),this._resetClickTimeout()}},{key:"_mouseEnterHandler",value:function(t){var e=this;this._unsubscribeMousemove&&this._unsubscribeMousemove();var i=this._mouseMoveHandler.bind(this),n=this._mouseWheelHandler.bind(this);this._unsubscribeMousemove=function(){e._target.removeEventListener("mousemove",i),e._target.removeEventListener("wheel",n)},this._target.addEventListener("mousemove",i),this._target.addEventListener("wheel",n,{passive:!1}),Ci(t)&&this._mouseMoveHandler(t);var r=this._makeCompatEvent(t);this._processEvent(r,this._handler.mouseEnterEvent)}},{key:"_resetClickTimeout",value:function(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null}},{key:"_mouseMoveHandler",value:function(t){if(!this._mousePressed||Ci(t)){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseMoveEvent)}}},{key:"_mouseWheelHandler",value:function(t){var e=this._makeCompatEvent(t);t.localX=e.localX,t.localY=e.localY,this._processEvent(t,this._handler.mouseWheelEvent)}},{key:"_mouseMoveWithDownHandler",value:function(t){if((!("button"in t)||t.button===Ei)&&null===this._startPinchMiddleCoordinate){var e=Ci(t);if(!this._preventDragProcess||!e){this._pinchPrevented=!0;var i=this._makeCompatEvent(t),n=this._mouseMoveStartPosition,r=Math.abs(n.x-i.pageX),a=Math.abs(n.y-i.pageY),o=r+a>5;if(o||!e){if(o&&!this._moveExceededManhattanDistance&&e){var s=.5*r;a>=s&&!this._options.treatVertTouchDragAsPageScroll||s>a&&!this._options.treatHorzTouchDragAsPageScroll||(this._preventDragProcess=!0)}o&&(this._moveExceededManhattanDistance=!0,this._cancelClick=!0,e&&this._clearLongTapTimeout()),this._preventDragProcess||(this._processEvent(i,this._handler.pressedMouseMoveEvent),e&&Ti(t))}}}}},{key:"_mouseUpHandler",value:function(t){if(!("button"in t)||t.button===Ei){var e=this._makeCompatEvent(t);this._clearLongTapTimeout(),this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),Ci(t)&&this._mouseLeaveHandler(t),this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1?(this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()):this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent),Ci(t)&&(Ti(t),this._mouseLeaveHandler(t),0===t.touches.length&&(this._longTapActive=!1))}}},{key:"_clearLongTapTimeout",value:function(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}},{key:"_mouseDownHandler",value:function(t){if(!("button"in t)||t.button===Ei||t.button===Pi){var e=this._makeCompatEvent(t);if("button"in t&&t.button===Pi)this._processEvent(e,this._handler.mouseRightDownEvent);else{this._cancelClick=!1,this._moveExceededManhattanDistance=!1,this._preventDragProcess=!1,Ci(t)&&this._mouseEnterHandler(t),this._mouseMoveStartPosition={x:e.pageX,y:e.pageY},this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null);var i=this._mouseMoveWithDownHandler.bind(this),n=this._mouseUpHandler.bind(this),r=this._target.ownerDocument.documentElement;this._unsubscribeRoot=function(){r.removeEventListener("touchmove",i),r.removeEventListener("touchend",n),r.removeEventListener("mousemove",i),r.removeEventListener("mouseup",n)},r.addEventListener("touchmove",i,{passive:!1}),r.addEventListener("touchend",n,{passive:!1}),this._clearLongTapTimeout(),Ci(t)&&1===t.touches.length?this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),600):(r.addEventListener("mousemove",i),r.addEventListener("mouseup",n)),this._mousePressed=!0,this._processEvent(e,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500))}}}},{key:"_init",value:function(){var t=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));var e,i=this._target.ownerDocument,n=function(e){t._handler.mouseDownOutsideEvent&&(e.target&&t._target.contains(e.target)||t._handler.mouseDownOutsideEvent())};this._unsubscribeOutsideEvents=function(){i.removeEventListener("mousedown",n),i.removeEventListener("touchstart",n)},i.addEventListener("mousedown",n),i.addEventListener("touchstart",n,{passive:!0}),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._mouseDownHandler.bind(this),{passive:!0}),e="ontouchstart"in window||!!(window.DocumentTouch&&document instanceof window.DocumentTouch),"onorientationchange"in window&&(navigator.maxTouchPoints||navigator.msMaxTouchPoints||e)||this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",(function(){}),{passive:!1})}},{key:"_initPinch",value:function(){var t=this;void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",(function(e){return t._checkPinchState(e.touches)}),{passive:!0}),this._target.addEventListener("touchmove",(function(e){if(2===e.touches.length&&null!==t._startPinchMiddleCoordinate&&void 0!==t._handler.pinchEvent){var i=Ii(e.touches[0],e.touches[1]);t._handler.pinchEvent(t._startPinchMiddleCoordinate,i/t._startPinchDistance),Ti(e)}}),{passive:!1}),this._target.addEventListener("touchend",(function(e){t._checkPinchState(e.touches)})))}},{key:"_checkPinchState",value:function(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}},{key:"_startPinch",value:function(t){var e=Ai(this._target);this._startPinchMiddleCoordinate={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=Ii(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent(),this._clearLongTapTimeout()}},{key:"_stopPinch",value:function(){null!==this._startPinchMiddleCoordinate&&(this._startPinchMiddleCoordinate=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent())}},{key:"_mouseLeaveHandler",value:function(t){this._unsubscribeMousemove&&this._unsubscribeMousemove();var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseLeaveEvent)}},{key:"_longTapHandler",value:function(t){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.longTapEvent),this._cancelClick=!0,this._longTapActive=!0}},{key:"_processEvent",value:function(t,e){e&&e.call(this._handler,t)}},{key:"_makeCompatEvent",value:function(t){var e;e="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var i=Ai(this._target);return{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,localX:e.clientX-i.left,localY:e.clientY-i.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?gi:xi,target:e.target,view:t.view}}}]),t}(),Di=function(){function t(i,n,r,a,o,s){e(this,t),this._chartStore=n,this._topPaneId=r,this._bottomPaneId=a,this._dragEnabled=o,this._width=0,this._offsetLeft=0,this._dragEventHandler=s,this._dragFlag=!1,this._initElement(i),this._initEvent(o)}return n(t,[{key:"_initElement",value:function(t){this._container=t,this._wrapper=ge("div",{margin:"0",padding:"0",position:"relative",boxSizing:"border-box"}),this._element=ge("div",{width:"100%",height:"7px",margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box"}),this._wrapper.appendChild(this._element);var e=t.lastChild;e?t.insertBefore(this._wrapper,e):t.appendChild(this._wrapper)}},{key:"_initEvent",value:function(t){t&&(this._element.style.cursor="ns-resize",this._dragEvent=new Oi(this._element,{mouseDownEvent:this._mouseDownEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),mouseEnterEvent:this._mouseEnterEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0}))}},{key:"_mouseDownEvent",value:function(t){this._dragFlag=!0,this._startY=t.pageY,this._dragEventHandler.startDrag(this._topPaneId,this._bottomPaneId)}},{key:"_mouseUpEvent",value:function(){this._dragFlag=!1,this._chartStore.setDragPaneFlag(!1)}},{key:"_pressedMouseMoveEvent",value:function(t){this._dragEventHandler.drag(t.pageY-this._startY,this._topPaneId,this._bottomPaneId),this._chartStore.setDragPaneFlag(!0),this._chartStore.crosshairStore().set()}},{key:"_mouseEnterEvent",value:function(){var t=this._chartStore.styleOptions().separator;this._element.style.background=t.activeBackgroundColor,this._chartStore.crosshairStore().set()}},{key:"_mouseLeaveEvent",value:function(){this._dragFlag||(this._element.style.background=null,this._chartStore.setDragPaneFlag(!1))}},{key:"height",value:function(){return this._wrapper.offsetHeight}},{key:"setSize",value:function(t,e){this._offsetLeft=t,this._width=e,this.invalidate()}},{key:"setDragEnabled",value:function(t){t!==this._dragEnabled&&(this._dragEnabled=t,t?!this._dragEvent&&this._initEvent(t):(this._element.style.cursor="default",this._dragEvent&&this._dragEvent.destroy(),this._dragEvent=null))}},{key:"topPaneId",value:function(){return this._topPaneId}},{key:"bottomPaneId",value:function(){return this._bottomPaneId}},{key:"updatePaneId",value:function(t,e){u(t)&&(this._topPaneId=t),u(e)&&(this._bottomPaneId=e)}},{key:"invalidate",value:function(){var t=this._chartStore.styleOptions().separator;this._element.style.top="".concat(-Math.floor((7-t.size)/2),"px"),this._wrapper.style.backgroundColor=t.color,this._wrapper.style.height="".concat(t.size,"px"),this._wrapper.style.marginLeft="".concat(t.fill?0:this._offsetLeft,"px"),this._wrapper.style.width=t.fill?"100%":"".concat(this._width,"px")}},{key:"getImage",value:function(){var t=this._chartStore.styleOptions().separator,e=this._wrapper.offsetWidth,i=t.size,n=ge("canvas",{width:"".concat(e,"px"),height:"".concat(i,"px"),boxSizing:"border-box"}),r=n.getContext("2d"),a=It(n);return n.width=e*a,n.height=i*a,r.scale(a,a),r.fillStyle=t.color,r.fillRect(this._offsetLeft,0,e,i),n}},{key:"destroy",value:function(){this._dragEvent&&this._dragEvent.destroy(),this._container.removeChild(this._wrapper)}}]),t}(),Mi=n((function t(i){e(this,t),this._chartStore=i}));function Li(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var Ri=function(t){tt(r,t);var i=Li(r);function r(t){var n;return e(this,r),(n=i.call(this,t))._flingStartTime=null,n._flingScrollTimerId=null,n._startScrollCoordinate=null,n._touchCoordinate=null,n._touchCancelCrosshair=!1,n._touchZoomed=!1,n._pinchScale=1,n}return n(r,[{key:"pinchStartEvent",value:function(){this._pinchScale=1,this._touchZoomed=!0}},{key:"pinchEvent",value:function(t,e){var i=5*(e-this._pinchScale);this._pinchScale=e,this._chartStore.timeScaleStore().zoom(i,t)}},{key:"mouseUpEvent",value:function(){this._startScrollCoordinate=null}},{key:"mouseLeaveEvent",value:function(t){var e=this;if(Si(t)){if(this._startScrollCoordinate){var i=(new Date).getTime()-this._flingStartTime,n=(t.localX-this._startScrollCoordinate.x)/(i>0?i:1)*20;if(200>i&&Math.abs(n)>0){!function t(){e._flingScrollTimerId=Ee((function(){e._chartStore.timeScaleStore().startScroll(),e._chartStore.timeScaleStore().scroll(n),1>Math.abs(n*=.975)?e._flingScrollTimerId&&(Pe(e._flingScrollTimerId),e._flingScrollTimerId=null):t()}))}()}}}else this._startScrollCoordinate=null,ki(t)&&this._chartStore.crosshairStore().set()}},{key:"mouseMoveEvent",value:function(t){ki(t)&&this._chartStore.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId})}},{key:"mouseWheelEvent",value:function(t){if(Math.abs(t.deltaX)>Math.abs(t.deltaY)){if(t.cancelable&&t.preventDefault(),0===Math.abs(t.deltaX))return;this._chartStore.timeScaleStore().startScroll(),this._chartStore.timeScaleStore().scroll(-t.deltaX)}else{var e=-t.deltaY/100;if(0===e)return;switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120;break;case t.DOM_DELTA_LINE:e*=32}if(0!==e){var i=Math.sign(e)*Math.min(1,Math.abs(e));this._chartStore.timeScaleStore().zoom(i,{x:t.localX,y:t.localY})}}}},{key:"mouseClickEvent",value:function(t){Si(t)&&(this._touchCoordinate||this._touchCancelCrosshair||this._touchZoomed||(this._touchCoordinate={x:t.localX,y:t.localY},this._chartStore.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId})))}},{key:"mouseDownEvent",value:function(t){if(this._flingScrollTimerId&&(Pe(this._flingScrollTimerId),this._flingScrollTimerId=null),this._flingStartTime=(new Date).getTime(),this._startScrollCoordinate={x:t.localX,y:t.localY},this._chartStore.timeScaleStore().startScroll(),Si(t))if(this._touchZoomed=!1,this._touchCoordinate){var e=t.localX-this._touchCoordinate.x,i=t.localY-this._touchCoordinate.y;10>Math.sqrt(e*e+i*i)?(this._touchCoordinate={x:t.localX,y:t.localY},this._chartStore.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId})):(this._touchCancelCrosshair=!0,this._touchCoordinate=null,this._chartStore.crosshairStore().set())}else this._touchCancelCrosshair=!1}},{key:"pressedMouseMoveEvent",value:function(t){var e={x:t.localX,y:t.paneY,paneId:t.paneId};if(Si(t)){if(this._touchCoordinate)return this._touchCoordinate={x:t.localX,y:t.localY},void this._chartStore.crosshairStore().set(e);e=null}if(this._startScrollCoordinate){var i=t.localX-this._startScrollCoordinate.x;this._chartStore.timeScaleStore().scroll(i,e)}}},{key:"longTapEvent",value:function(t){Si(t)&&(this._touchCoordinate={x:t.localX,y:t.localY},this._chartStore.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId}))}}]),r}(Mi);function Fi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Bi(t){for(var e=1;arguments.length>e;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Fi(Object(i),!0).forEach((function(e){mt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Fi(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function zi(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return Hi(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Hi(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return t.length>n?{done:!1,value:t[n++]}:{done:!0}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function Hi(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);e>i;i++)n[i]=t[i];return n}function ji(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var Vi=function(t){tt(r,t);var i=ji(r);function r(t,n){var a;return e(this,r),(a=i.call(this,t))._yAxis=n,a}return n(r,[{key:"_performOverlayMouseHover",value:function(t,e,i,n){var r;if(t){var a,o=zi(t);try{for(o.s();!(a=o.n()).done;){if(r=a.value.checkEventCoordinateOn(i))break}}catch(t){o.e(t)}finally{o.f()}r&&e.id===r.id||(e.id&&e.instance&&ki(n)&&e.instance.onMouseLeave({id:e.id,points:e.instance.points(),event:n}),r&&r.id!==e.id&&r.instance&&ki(n)&&r.instance.onMouseEnter({id:r.id,points:r.instance.points(),event:n}))}return r}},{key:"mouseUpEvent",value:function(){this._chartStore.shapeStore().updatePressedInstance()}},{key:"mouseMoveEvent",value:function(t){if(ki(t)){if(this._waitingForMouseMove)return!1;this._waitingForMouseMove=!0;var e,i,n,r={x:t.localX,y:t.paneY},a=this._chartStore.shapeStore().progressInstance(),o=a.instance,s=a.paneId;if(o&&o.isDrawing())t.paneId&&(o.isStart()&&this._chartStore.shapeStore().updateProgressInstance(this._yAxis(t.paneId),t.paneId),s===t.paneId&&o.mouseMoveForDrawing(r,t),e={id:o.id(),element:Ht,elementIndex:o.points().length-1}),i={id:"",element:jt,elementIndex:-1};else{var c=this._chartStore.annotationStore().get(t.paneId),h=this._chartStore.shapeStore().instances(t.paneId),l=this._chartStore.shapeStore().eventOperate().hover,u=this._chartStore.annotationStore().eventOperate();e=this._performOverlayMouseHover(h,l,r,t),n=this._performOverlayMouseHover(c,u,r,t)}this._chartStore.shapeStore().setEventOperate({hover:e||{id:"",element:jt,elementIndex:-1},click:i}),this._chartStore.annotationStore().setEventOperate(n||{id:""}),this._waitingForMouseMove=!1}}},{key:"mouseDownEvent",value:function(t){var e,i={x:t.localX,y:t.paneY},n=this._chartStore.shapeStore().progressInstance(),r=n.instance,a={id:"",element:jt,elementIndex:-1},o=n.paneId;if(r&&r.isDrawing())Si(t)&&(r.isStart()&&(this._chartStore.shapeStore().updateProgressInstance(this._yAxis(t.paneId),t.paneId),o=t.paneId),o===t.paneId&&r.mouseMoveForDrawing(i,t)),o===t.paneId&&(r.mouseLeftButtonDownForDrawing(),e={id:r.id(),element:Ht,elementIndex:r.points().length-1},a={id:r.id(),element:Ht,elementIndex:r.points().length-1});else{var s,c=zi(this._chartStore.shapeStore().instances(t.paneId));try{for(c.s();!(s=c.n()).done;){var h=s.value;if(e=h.checkEventCoordinateOn(i)){this._chartStore.shapeStore().updatePressedInstance(h,t.paneId,e.element),e.element===Ht?a=Bi({},e):h.startPressedOtherMove(i),h.onClick({id:e.id,points:h.points(),event:t});break}}}catch(t){c.e(t)}finally{c.f()}var l=this._chartStore.annotationStore().get(t.paneId);if(l){var u,f=zi(l);try{for(f.s();!(u=f.n()).done;){var d=u.value,v=d.checkEventCoordinateOn(i);if(v){d.onClick({id:v.id,points:d.points(),event:t});break}}}catch(t){f.e(t)}finally{f.f()}}}this._chartStore.shapeStore().setEventOperate({hover:a,click:e||{id:"",element:jt,elementIndex:-1}})&&this._chartStore.invalidate(qt)}},{key:"mouseRightDownEvent",value:function(t){var e,i=this._chartStore.shapeStore().progressInstance().instance;i?e=i:e=this._chartStore.shapeStore().instances(t.paneId).find((function(e){return e.checkEventCoordinateOn({x:t.localX,y:t.paneY})}));e&&!e.onRightClick({id:e.id(),points:e.points(),event:t})&&this._chartStore.shapeStore().removeInstance(e.id());var n=this._chartStore.annotationStore().get(t.paneId);if(n){var r=n.find((function(e){return e.checkEventCoordinateOn({x:t.localX,y:t.paneY})}));r&&r.onRightClick({id:r.id(),points:r.points(),event:t})}}},{key:"pressedMouseMoveEvent",value:function(t){var e=this._chartStore.shapeStore().pressedInstance(),i=e.instance;if(i&&e.paneId===t.paneId){var n={x:t.localX,y:t.paneY};e.element===Ht?i.mousePressedPointMove(n,t):i.mousePressedOtherMove(n,t),this._chartStore.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId})}}}]),r}(Mi);function Yi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var Wi="Equal",Ni="Minus",Xi="ArrowLeft",Gi="ArrowRight",Ui=function(t){tt(r,t);var i=Yi(r);function r(){return e(this,r),i.apply(this,arguments)}return n(r,[{key:"keyBoardDownEvent",value:function(t){if(t.shiftKey)switch(t.code){case Wi:this._chartStore.timeScaleStore().zoom(.5);break;case Ni:this._chartStore.timeScaleStore().zoom(-.5);break;case Xi:this._chartStore.timeScaleStore().startScroll(),this._chartStore.timeScaleStore().scroll(-3*this._chartStore.timeScaleStore().dataSpace());break;case Gi:this._chartStore.timeScaleStore().startScroll(),this._chartStore.timeScaleStore().scroll(3*this._chartStore.timeScaleStore().dataSpace())}}}]),r}(Mi),Zi=function(){function t(i,n,r){e(this,t),this._target=i,this._chartStore=n,this._chartContentLeftRight={},this._chartContentTopBottom={},this._paneContentSize={},this._event=new Oi(this._target,{pinchStartEvent:this._pinchStartEvent.bind(this),pinchEvent:this._pinchEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),mouseClickEvent:this._mouseClickEvent.bind(this),mouseDownEvent:this._mouseDownEvent.bind(this),mouseRightDownEvent:this._mouseRightDownEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this),mouseMoveEvent:this._mouseMoveEvent.bind(this),mouseWheelEvent:this._mouseWheelEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),longTapEvent:this._longTapEvent.bind(this)},{treatVertTouchDragAsPageScroll:!0,treatHorzTouchDragAsPageScroll:!1}),this._boundKeyBoardDownEvent=this._keyBoardDownEvent.bind(this),this._target.addEventListener("keydown",this._boundKeyBoardDownEvent),this._boundContextMenuEvent=function(t){t.preventDefault()},this._target.addEventListener("contextmenu",this._boundContextMenuEvent,!1),this._zoomScrollEventHandler=new Ri(n),this._overlayEventHandler=new Vi(n,r),this._keyBoardEventHandler=new Ui(n)}return n(t,[{key:"_keyBoardDownEvent",value:function(t){this._keyBoardEventHandler.keyBoardDownEvent(t)}},{key:"_pinchStartEvent",value:function(){this._zoomScrollEventHandler.pinchStartEvent()}},{key:"_pinchEvent",value:function(t,e){this._zoomScrollEventHandler.pinchEvent(t,e)}},{key:"_mouseUpEvent",value:function(t){this._checkEventInChartContent(t)&&(this._target.style.cursor="crosshair"),this._zoomScrollEventHandler.mouseUpEvent(t),this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseUpEvent(t)}},{key:"_mouseLeaveEvent",value:function(t){this._zoomScrollEventHandler.mouseLeaveEvent(t)}},{key:"_mouseMoveEvent",value:function(t){if(t.target instanceof HTMLCanvasElement)if(this._checkEventInChartContent(t)){this._target.style.cursor="crosshair";var e=this._compatChartEvent(t,!0);this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseMoveEvent(e),this._chartStore.dragPaneFlag()||this._zoomScrollEventHandler.mouseMoveEvent(e)}else this._target.style.cursor="default",this._zoomScrollEventHandler.mouseLeaveEvent(t);else this._target.style.cursor="default",this._chartStore.crosshairStore().set()}},{key:"_mouseWheelEvent",value:function(t){this._checkZoomScroll()&&this._checkEventInChartContent(t)&&this._zoomScrollEventHandler.mouseWheelEvent(this._compatChartEvent(t))}},{key:"_mouseClickEvent",value:function(t){this._checkZoomScroll()&&this._checkEventInChartContent(t)&&(this._zoomScrollEventHandler.mouseClickEvent(this._compatChartEvent(t,!0)),this._modifyEventOptions(t))}},{key:"_mouseDownEvent",value:function(t){if(this._checkEventInChartContent(t)){this._target.style.cursor="pointer";var e=this._compatChartEvent(t,!0);this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseDownEvent(e),this._checkZoomScroll()&&(this._zoomScrollEventHandler.mouseDownEvent(e),this._modifyEventOptions(t))}}},{key:"_mouseRightDownEvent",value:function(t){this._shouldPerformOverlayEvent()&&this._checkEventInChartContent(t)&&this._overlayEventHandler.mouseRightDownEvent(this._compatChartEvent(t,!0))}},{key:"_pressedMouseMoveEvent",value:function(t){if(this._checkEventInChartContent(t)){var e=this._compatChartEvent(t,!0);this._checkZoomScroll()?(this._zoomScrollEventHandler.pressedMouseMoveEvent(e),this._modifyEventOptions(t)):this._overlayEventHandler.pressedMouseMoveEvent(e)}}},{key:"_longTapEvent",value:function(t){this._checkZoomScroll()&&this._checkEventInChartContent(t)&&(this._zoomScrollEventHandler.longTapEvent(this._compatChartEvent(t,!0)),this._modifyEventOptions(t))}},{key:"_checkZoomScroll",value:function(){return!this._chartStore.dragPaneFlag()&&!this._chartStore.shapeStore().isPressed()&&!this._chartStore.shapeStore().isDrawing()}},{key:"_shouldPerformOverlayEvent",value:function(){return!this._chartStore.shapeStore().isEmpty()||!this._chartStore.annotationStore().isEmpty()}},{key:"_modifyEventOptions",value:function(t){Si(t)&&this._chartStore.crosshairStore().get().paneId?this._event.setOptions({treatVertTouchDragAsPageScroll:!1}):this._event.setOptions({treatVertTouchDragAsPageScroll:!0})}},{key:"_compatChartEvent",value:function(t,e){if(e)for(var i in this._paneContentSize)if(Object.prototype.hasOwnProperty.call(this._paneContentSize,i)){var n=this._paneContentSize[i];if(t.localY>n.contentTop&&n.contentBottom>t.localY){t.paneY=t.localY-n.contentTop,t.paneId=i;break}}return t.localX-=this._chartContentLeftRight.contentLeft,t}},{key:"_checkEventInChartContent",value:function(t){return t.localX>this._chartContentLeftRight.contentLeft&&this._chartContentLeftRight.contentRight>t.localX&&t.localY>this._chartContentTopBottom.contentTop&&this._chartContentTopBottom.contentBottom>t.localY}},{key:"setChartContentLeftRight",value:function(t){this._chartContentLeftRight=t}},{key:"setChartContentTopBottom",value:function(t){this._chartContentTopBottom=t}},{key:"setPaneContentSize",value:function(t){this._paneContentSize=t}},{key:"destroy",value:function(){this._event.destroy(),this._target.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._target.removeEventListener("contextmenu",this._boundContextMenuEvent)}}]),t}();function Ki(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=0;return function(){var n=Date.now(),r=this,a=arguments;n-i>e&&(t.apply(r,a),i=n)}}function $i(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var qi=function(t){tt(r,t);var i=$i(r);function r(t){var n,a=t.id,o=t.point,s=void 0===o?{}:o,c=t.chartStore,h=t.xAxis,l=t.yAxis,u=t.styles;return e(this,r),(n=i.call(this,{id:a,chartStore:c,points:s,xAxis:h,yAxis:l}))._symbolCoordinate={},n.setStyles(u,c.styleOptions().annotation),n}return n(r,[{key:"_drawSymbol",value:function(t,e,i){var n=this._chartStore.timeScaleStore().barSpace(),r=i.symbol,a=r.size,o=r.activeSize,s=e?l(o)?o:n:l(a)?a:n,c=e?r.activeColor:r.color;switch(r.type){case M:St(t,c,this._symbolCoordinate,s/2);break;case L:!function(t,e,i,n,r,a){t.fillStyle=e,t.fillRect(i,n,r,a)}(t,c,this._symbolCoordinate.x-s/2,this._symbolCoordinate.y-s/2,s,s);break;case F:!function(t,e,i,n,r){t.fillStyle=e,t.beginPath(),t.moveTo(i.x-n/2,i.y),t.lineTo(i.x,i.y-r/2),t.lineTo(i.x+n/2,i.y),t.lineTo(i.x,i.y+r/2),t.closePath(),t.fill()}(t,c,this._symbolCoordinate,s,s);break;case R:!function(t,e,i,n,r){t.fillStyle=e,t.beginPath(),t.moveTo(i.x-n/2,i.y+r/2),t.lineTo(i.x,i.y-r/2),t.lineTo(i.x+n/2,i.y+r/2),t.closePath(),t.fill()}(t,c,this._symbolCoordinate,s,s);break;case B:t.save(),this.drawCustomSymbol({ctx:t,point:this._points,coordinate:this._symbolCoordinate,viewport:{width:this._xAxis.width(),height:this._yAxis.height(),barSpace:n},styles:r,isActive:e}),t.restore()}}},{key:"draw",value:function(t){var e=this._styles||this._chartStore.styleOptions().annotation,i=e.offset||[0,0],n=0;switch(e.position){case z:n=this._yAxis.convertToPixel(this._points.value);break;case H:n=0;break;case j:n=this._yAxis.height()}this._symbolCoordinate.y=n+i[0];var r=this._id===this._chartStore.annotationStore().eventOperate().id;this._drawSymbol(t,r,e),this.drawExtend&&(t.save(),this.drawExtend({ctx:t,point:this._points,coordinate:this._symbolCoordinate,viewport:{width:this._xAxis.width(),height:this._yAxis.height()},styles:e,isActive:r}),t.restore())}},{key:"checkEventCoordinateOn",value:function(t){var e,i,n,r,a,o=this._chartStore.timeScaleStore().barSpace(),s=(this._styles||this._chartStore.styleOptions().annotation).symbol,c=l(s.size)?s.size:o;switch(s.type){case M:e=bt(this._symbolCoordinate,c/2,t);break;case L:e=function(t,e,i){return!(t.x>i.x||i.x>e.x||t.y>i.y||i.y>e.y)}({x:this._symbolCoordinate.x-c/2,y:this._symbolCoordinate.y-c/2},{x:this._symbolCoordinate.x+c/2,y:this._symbolCoordinate.y+c/2},t);break;case F:e=(n=c)*(r=c)/2+2>Math.abs((i=this._symbolCoordinate).x-(a=t).x)*r+Math.abs(i.y-a.y)*n;break;case R:e=function(t,e){var i=kt(t[0],t[1],t[2]),n=kt(t[0],t[1],e)+kt(t[0],t[2],e)+kt(t[1],t[2],e);return 2>Math.abs(i-n)}([{x:this._symbolCoordinate.x-c/2,y:this._symbolCoordinate.y+c/2},{x:this._symbolCoordinate.x,y:this._symbolCoordinate.y-c/2},{x:this._symbolCoordinate.x+c/2,y:this._symbolCoordinate.y+c/2}],t);break;case B:e=this.checkEventCoordinateOnCustomSymbol({eventCoordinate:t,coordinate:this._symbolCoordinate,size:c})}if(e)return{id:this._id,instance:this}}},{key:"createSymbolCoordinate",value:function(t){var e=this._styles||this._chartStore.styleOptions().annotation;this._symbolCoordinate={x:t+(e.offset||[0,0])[1]}}},{key:"checkEventCoordinateOnCustomSymbol",value:function(t){}},{key:"drawCustomSymbol",value:function(t){}}]),r}(xt);function Ji(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=it(t);if(e){var r=it(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return et(this,i)}}var Qi=function(t){tt(r,t);var i=Ji(r);function r(t){var n,a=t.id,o=t.point,s=void 0===o?{}:o,c=t.text,h=t.mark,l=t.chartStore,u=t.xAxis,f=t.yAxis,d=t.styles;return e(this,r),(n=i.call(this,{id:a,chartStore:l,points:s,xAxis:u,yAxis:f}))._text=c,n._mark=h,n.setStyles(d,l.styleOptions().tag),n}return n(r,[{key:"update",value:function(t){var e=t.point,i=t.text,n=t.mark,r=t.styles,a=!1;return h(e)&&(this._points=e,a=!0),u(i)&&(this._text=i,a=!0),u(n)&&(this._mark=n,a=!0),this.setStyles(r,this._chartStore.styleOptions().tag)&&(a=!0),a}},{key:"drawMarkLine",value:function(t){var e=this._chartStore.styleOptions(),i=e.yAxis,n=this._styles||e.tag,r=this._getY(n);t.save(),this._drawLine(t,r,n,i),this._drawMark(t,r,n,i),t.restore()}},{key:"drawText",value:function(t){if(u(this._text)){var e=this._chartStore.styleOptions(),i=this._styles||e.tag,n=i.text;t.save();var r,a=Mt(t,this._text,n),o=Lt(n);r=this._yAxis.isFromYAxisZero()?0:this._yAxis.width()-a;var s=this._getY(i);Re(t,n.backgroundColor,n.borderColor,n.borderSize,r,s-o/2,a,o,n.borderRadius),Ie(t,n.color,r+n.paddingLeft,s,this._text),t.restore()}}},{key:"_drawLine",value:function(t,e,i,n){var r=i.line;if(r.show){t.save();var a=Mt(t,this._text,i.text),o=Mt(t,this._mark,i.mark);t.strokeStyle=r.color,t.lineWidth=r.size,r.style===p&&t.setLineDash(r.dashValue);var s=i.mark.offset,c=[],h=u(this._text),l=u(this._mark);n.inside?n.position===m?h&&l?s>0?(c.push([a,a+s]),c.push([a+s+o,this._xAxis.width()])):c.push(Math.min(a,o)>Math.abs(s)?[a+s+o,this._xAxis.width()]:[Math.max(a,o),this._xAxis.width()]):h?c.push([a,this._xAxis.width()]):l?s>0?(c.push([0,s]),c.push([s+o,this._xAxis.width()])):c.push(o>Math.abs(s)?[s+o,this._xAxis.width()]:[0,this._xAxis.width()]):c.push([0,this._xAxis.width()]):h&&l?0>s?(c.push([0,this._xAxis.width()-a+s-o]),c.push([this._xAxis.width()-a+s,this._xAxis.width()-a])):c.push(Math.min(a,o)>s?[0,this._xAxis.width()-a-o+s]:[0,this._xAxis.width()-Math.max(a,o)]):h?c.push([0,this._xAxis.width()-a]):l?0>s?(c.push([0,this._xAxis.width()+s-o]),c.push([this._xAxis.width()+s,this._xAxis.width()])):c.push(o>s?[0,this._xAxis.width()-o+s]:[0,this._xAxis.width()]):c.push([0,this._xAxis.width()]):n.position===m?l?s>0?(c.push([0,s]),c.push([s+o,this._xAxis.width()])):c.push(o>Math.abs(s)?[o+s,this._xAxis.width()]:[0,this._xAxis.width()]):c.push([0,this._xAxis.width()]):l?0>s?(c.push([0,this._xAxis.width()-o+s]),c.push([this._xAxis.width()+s,this._xAxis.width()])):c.push(o>s?[0,this._xAxis.width()-o+s]:[0,this._xAxis.width()]):c.push([0,this._xAxis.width()]),c.forEach((function(i){At(t,e,i[0],i[1])})),t.restore()}}},{key:"_drawMark",value:function(t,e,i,n){if(u(this._mark)){var r,a=i.mark,o=Mt(t,this._mark,a),s=Lt(a);if(n.inside){var c=0;u(this._text)&&(c=Mt(t,this._text,i.text)),r=n.position===m?c:this._xAxis.width()-c-o}else r=n.position===m?0:this._xAxis.width()-o;Re(t,a.backgroundColor,a.borderColor,a.borderSize,r+=a.offset,e-s/2,o,s,a.borderRadius),t.textBaseline="middle",t.font=Dt(a.size,a.weight,a.family),Ie(t,a.color,r+a.paddingLeft,e,this._mark)}}},{key:"_getY",value:function(t){var e=t.offset;switch(t.position){case H:return e;case j:return this._yAxis.height()+e;default:return this._yAxis.convertToNicePixel(this._points.value)+e}}}]),r}(xt);function tn(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return en(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return en(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return t.length>n?{done:!1,value:t[n++]}:{done:!0}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function en(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);e>i;i++)n[i]=t[i];return n}var nn="tech_pane_",rn="candle_pane",an=function(){function t(i,n){var r=this;e(this,t),this._initChartContainer(i),this._separatorDragStartTopPaneHeight=0,this._separatorDragStartBottomPaneHeight=0,this._chartStore=new pe(n,{invalidate:this._invalidatePane.bind(this),crosshair:this._crosshairObserver.bind(this)}),this._xAxisPane=new _i({id:"x_axis_pane",container:this._chartContainer,chartStore:this._chartStore}),this._panes=new Map([[rn,new ai({container:this._chartContainer,chartStore:this._chartStore,xAxis:this._xAxisPane.xAxis(),id:rn})]]),this._separators=new Map,this._chartWidth={},this._chartHeight={},this._chartEvent=new Zi(this._chartContainer,this._chartStore,(function(t){return r._panes.get(t).yAxis()})),this.adjustPaneViewport(!0,!0,!0)}return n(t,[{key:"_initChartContainer",value:function(t){this._container=t,this._chartContainer=ge("div",{userSelect:"none",webkitUserSelect:"none",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent",position:"relative",outline:"none",borderStyle:"none",width:"100%",cursor:"crosshair",boxSizing:"border-box"}),this._chartContainer.tabIndex=1,t.appendChild(this._chartContainer)}},{key:"_crosshairObserver",value:function(t){var e=this,i=t.paneId,n=t.dataIndex,r=t.kLineData,a=t.x,o=t.y;if(this._chartStore.actionStore().has($.CROSSHAIR)||this._chartStore.actionStore().has($.TOOLTIP)){var s={};this._panes.forEach((function(t,i){var a={},o=[];e.chartStore().technicalIndicatorStore().instances(i).forEach((function(t){var e=t.result[n];a[t.name]=e,o.push({name:t.name,data:e})})),s[i]=a,e._chartStore.actionStore().execute($.TOOLTIP,{paneId:i,dataIndex:n,kLineData:r,technicalIndicatorData:o})})),i&&this._chartStore.actionStore().execute($.CROSSHAIR,{paneId:i,coordinate:{x:a,y:o},dataIndex:n,kLineData:r,technicalIndicatorData:s})}}},{key:"_separatorStartDrag",value:function(t,e){this._separatorDragStartTopPaneHeight=this._panes.get(t).height(),this._separatorDragStartBottomPaneHeight=this._panes.get(e).height()}},{key:"_separatorDrag",value:function(t,e,i){var n=this._panes.get(e),r=this._panes.get(i),a=n.minHeight(),o=r.minHeight(),s=this._separatorDragStartTopPaneHeight+t,c=this._separatorDragStartBottomPaneHeight-t;s>this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight&&(s=this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight,c=0),0>s&&(s=0,c=this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight),a>s&&(c-=o-s,s=a),o>c&&(s-=a-c,c=o),n.setHeight(s),r.setHeight(c),this._chartStore.actionStore().execute($.PANE_DRAG,{topPaneId:e,bottomPaneId:i,topPaneHeight:s,bottomPaneHeight:c}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}},{key:"_invalidatePane",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Qt;if(t===qt)this._xAxisPane.invalidate(t),this._panes.forEach((function(e){e.invalidate(t)}));else{var e=!1;this._panes.forEach((function(t){var i=t.yAxis().computeAxis();i&&(e=i)})),this.adjustPaneViewport(!1,e,!0)}}},{key:"_measurePaneHeight",value:function(){var t=this,e=this._chartStore.styleOptions(),i=this._container.offsetHeight,n=e.separator.size,r=n*this._separators.size,a=this._xAxisPane.xAxis().getSelfHeight(),o=i-a-r;0>o&&(o=0);var s=0;this._panes.forEach((function(t){if(t.id()!==rn){var e=t.height(),i=t.minHeight();i>e&&(e=i),s+e>o?0>(e=o-(s=o))&&(e=0):s+=e,t.setHeight(e)}}));var c=o-s,h={};h.candle_pane={contentTop:0,contentBottom:c};var l=c,u=c;this._panes.get(rn).setHeight(c),this._chartHeight.candle_pane=c,this._panes.forEach((function(e){if(e.id()!==rn){var i=e.height();u+=i+n,h[e.id()]={contentTop:l,contentBottom:u},t._chartHeight[e.id()]=i,l=u}})),this._xAxisPane.setHeight(a),this._chartHeight.xAxis=a,this._chartHeight.total=i,this._chartEvent.setPaneContentSize(h),this._chartEvent.setChartContentTopBottom({contentTop:0,contentBottom:u})}},{key:"_measurePaneWidth",value:function(){var t,e,i,n=this,r=this._chartStore.styleOptions().yAxis,a=r.position===m,o=!r.inside,s=this._container.offsetWidth,c=Number.MIN_SAFE_INTEGER;this._panes.forEach((function(t){c=Math.max(c,t.yAxis().getSelfWidth())})),c>s&&(c=s),o?(t=s-c,a?(e=0,i=c):(e=s-c,i=0)):(t=s,i=0,e=a?0:s-c);var h=t;h<this._chartStore.timeScaleStore().dataSpace()&&(h=this._chartStore.timeScaleStore().dataSpace()),this._chartStore.timeScaleStore().setTotalDataSpace(h),this._panes.forEach((function(r,a){r.setWidth(t,c),r.setOffsetLeft(i,e);var o=n._separators.get(a);o&&o.setSize(i,t)})),this._chartWidth={content:t,yAxis:c,total:s},this._xAxisPane.setWidth(t,c),this._xAxisPane.setOffsetLeft(i,e),this._chartEvent.setChartContentLeftRight({contentLeft:i,contentRight:i+t})}},{key:"getContainer",value:function(){return this._container}},{key:"adjustPaneViewport",value:function(t,e,i,n,r){t&&this._measurePaneHeight();var a=!1;n&&this._panes.forEach((function(t){var e=t.yAxis().computeAxis(r);a||(a=e)})),(!n&&e||n&&a)&&this._measurePaneWidth(),i&&(this._xAxisPane.xAxis().computeAxis(!0),this._xAxisPane.layout(),this._panes.forEach((function(t){t.layout()})))}},{key:"hasPane",value:function(t){return this._panes.has(t)}},{key:"getPane",value:function(t){return this._panes.get(t)}},{key:"chartStore",value:function(){return this._chartStore}},{key:"removeTechnicalIndicator",value:function(t,e){var i=this;if(this._chartStore.technicalIndicatorStore().removeInstance(t,e)){var n=!1;if(t!==rn&&!this._chartStore.technicalIndicatorStore().hasInstance(t)){n=!0,this._panes.get(t).destroy();var r=this._separators.get(t).topPaneId();this._separators.get(t).destroy(),this._panes.delete(t),this._separators.delete(t),this._separators.forEach((function(t){var e=t.topPaneId();i._separators.has(e)||t.updatePaneId(r)}))}this.adjustPaneViewport(n,!0,!0,!0,!0)}}},{key:"createTechnicalIndicator",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._panes.has(n.id)){var r=this._chartStore.technicalIndicatorStore().addInstance(n.id,t,e);return r&&r.finally((function(t){i.setPaneOptions(n,i._panes.get(n.id).yAxis().computeAxis(!0))})),n.id}var a=n.id||mi(nn),o=!f(n.dragEnabled)||n.dragEnabled;this._separators.set(a,new Di(this._chartContainer,this._chartStore,Array.from(this._panes.keys()).pop(),a,o,{startDrag:this._separatorStartDrag.bind(this),drag:Ki(this._separatorDrag.bind(this),50)}));var s=new qe({container:this._chartContainer,chartStore:this._chartStore,xAxis:this._xAxisPane.xAxis(),id:a,height:n.height||100,minHeight:n.minHeight});this._panes.set(a,s);var c=this._chartStore.technicalIndicatorStore().addInstance(a,t,e);return c&&c.finally((function(t){i.adjustPaneViewport(!0,!0,!0,!0,!0)})),a}},{key:"createShape",value:function(t,e,i){var n=e.points,r=e.styles,a=e.lock,o=e.mode,s=e.data,h=e.onDrawStart,l=e.onDrawing,u=e.onDrawEnd,f=e.onClick,d=e.onRightClick,v=e.onPressedMove,_=e.onMouseEnter,p=e.onMouseLeave,y=e.onRemove,m=e.id||mi("shape_");if(!this._chartStore.shapeStore().hasInstance(m)){var g=null;this.hasPane(i)?g=this._panes.get(i).yAxis():n&&n.length>0&&(i=rn,g=this._panes.get(rn).yAxis());var x=new t({id:m,chartStore:this._chartStore,xAxis:this._xAxisPane.xAxis(),yAxis:g,points:n,styles:r,lock:a,mode:o,data:s});return c(h)&&h({id:m}),gt(x,[{key:"onDrawing",fn:l},{key:"onDrawEnd",fn:u},{key:"onClick",fn:f},{key:"onRightClick",fn:d},{key:"onPressedMove",fn:v},{key:"onMouseEnter",fn:_},{key:"onMouseLeave",fn:p},{key:"onRemove",fn:y}]),this._chartStore.shapeStore().addInstance(x,i),m}return null}},{key:"createAnnotation",value:function(t,e){var i=this,n=[];t.forEach((function(t){var r=t.point,a=t.styles,o=t.checkEventCoordinateOnCustomSymbol,s=t.drawCustomSymbol,c=t.drawExtend,h=t.onClick,l=t.onRightClick,u=t.onMouseEnter,f=t.onMouseLeave;if(r&&r.timestamp){var d=new qi({id:mi("an_"),chartStore:i._chartStore,point:r,xAxis:i._xAxisPane.xAxis(),yAxis:i._panes.get(e).yAxis(),styles:a});gt(d,[{key:"drawExtend",fn:c},{key:"drawCustomSymbol",fn:s},{key:"checkEventCoordinateOnCustomSymbol",fn:o},{key:"onClick",fn:h},{key:"onRightClick",fn:l},{key:"onMouseEnter",fn:u},{key:"onMouseLeave",fn:f}]),n.push(d)}})),n.length>0&&this._chartStore.annotationStore().add(n,e)}},{key:"createTag",value:function(t,e){var i=this,n=[],r=!1,a=!1;t.forEach((function(t){var o=t.id,s=t.point,c=t.text,h=t.mark,l=t.styles;if(u(o))if(i._chartStore.tagStore().has(o,e)){var f=i._chartStore.tagStore().update(o,e,{point:s,text:c,mark:h,styles:l});r||(r=f)}else a=!0,n.push(new Qi({id:o,point:s,text:c,mark:h,styles:l,chartStore:i._chartStore,xAxis:i._xAxisPane.xAxis(),yAxis:i._panes.get(e).yAxis()}))})),a?this._chartStore.tagStore().add(n,e):r&&this._invalidatePane(qt)}},{key:"removeAllHtml",value:function(){this._panes.forEach((function(t){t.removeHtml()})),this._xAxisPane.removeHtml()}},{key:"setPaneOptions",value:function(t,e){var i=e,n=!1;if(t.id!==rn){var r=this._panes.get(t.id);if(r){if(l(t.minHeight)&&t.minHeight>0&&r.setMinHeight(t.minHeight),l(t.height)&&t.height>0){var a=r.minHeight(),o=r.minHeight>t.height?a:t.height;r.height()!==o&&(i=!0,r.setHeight(t.height),n=!0)}f(t.dragEnabled)&&this._separators.get(t.id).setDragEnabled(t.dragEnabled)}}i&&this.adjustPaneViewport(n,!0,!0,!0,!0)}},{key:"setTimezone",value:function(t){this._chartStore.timeScaleStore().setTimezone(t),this._xAxisPane.xAxis().computeAxis(!0),this._xAxisPane.invalidate(Qt)}},{key:"convertToPixel",value:function(t,e){var i,n=this,r=e.paneId,a=void 0===r?rn:r,o=e.absoluteYAxis,c=[].concat(t),h=[],l=this._chartStore.styleOptions().separator.size,f=0,d=tn(this._panes.values());try{var v=function(){var t=i.value;if(t.id()===a)return h=c.map((function(e){var i=e.timestamp,r=e.value,a={},s=e.dataIndex;if(u(i)&&(s=n._chartStore.timeScaleStore().timestampToDataIndex(i)),u(s)&&(a.x=n._xAxisPane.xAxis().convertToPixel(s)),u(r)){var c=t.yAxis().convertToPixel(r);a.y=o?f+c:c}return a})),"break";f+=t.height()+l};for(d.s();!(i=d.n()).done;){if("break"===v())break}}catch(t){d.e(t)}finally{d.f()}return s(t)?h:h[0]||{}}},{key:"convertFromPixel",value:function(t,e){var i,n=this,r=e.paneId,a=void 0===r?rn:r,o=e.absoluteYAxis,c=[].concat(t),h=[],l=this._chartStore.styleOptions().separator.size,f=0,d=tn(this._panes.values());try{var v=function(){var t=i.value;if(t.id()===a)return h=c.map((function(e){var i=e.x,r=e.y,a={};if(u(i)&&(a.dataIndex=n._xAxisPane.xAxis().convertFromPixel(i),a.timestamp=n._chartStore.timeScaleStore().dataIndexToTimestamp(a.dataIndex)),u(r)){var s=o?r-f:r;a.value=t.yAxis().convertFromPixel(s)}return a})),"break";f+=t.height()+l};for(d.s();!(i=d.n()).done;){if("break"===v())break}}catch(t){d.e(t)}finally{d.f()}return s(t)?h:h[0]||{}}},{key:"chartWidth",value:function(){return this._chartWidth}},{key:"chartHeight",value:function(){return this._chartHeight}},{key:"getConvertPictureUrl",value:function(t,e,i){var n=this,r=this._chartContainer.offsetWidth,a=this._chartContainer.offsetHeight,o=ge("canvas",{width:"".concat(r,"px"),height:"".concat(a,"px"),boxSizing:"border-box"}),s=o.getContext("2d"),c=It(o);o.width=r*c,o.height=a*c,s.scale(c,c),s.fillStyle=i,s.fillRect(0,0,r,a);var h=0;return this._panes.forEach((function(e,i){if(i!==rn){var a=n._separators.get(i);s.drawImage(a.getImage(),0,h,r,a.height()),h+=a.height()}s.drawImage(e.getImage(t),0,h,r,e.height()),h+=e.height()})),s.drawImage(this._xAxisPane.getImage(t),0,h,r,this._xAxisPane.height()),o.toDataURL("image/".concat(e))}},{key:"destroy",value:function(){this._panes.forEach((function(t){t.destroy()})),this._separators.forEach((function(t){t.destroy()})),this._panes.clear(),this._separators.clear(),this._xAxisPane.destroy(),this._container.removeChild(this._chartContainer),this._chartEvent.destroy()}}]),t}(),on=function(){function t(i,n){e(this,t),this._chartPane=new an(i,n)}return n(t,[{key:"getDom",value:function(t){if(t){if(!h(t))return null;var e=t.position,i=this._chartPane.getPane(t.paneId);return i&&i.container(e)||null}return this._chartPane.getContainer()}},{key:"getWidth",value:function(){return this._chartPane.chartWidth()}},{key:"getHeight",value:function(){return this._chartPane.chartHeight()}},{key:"setStyleOptions",value:function(t){h(t)&&(this._chartPane.chartStore().applyStyleOptions(t),this._chartPane.adjustPaneViewport(!0,!0,!0,!0,!0))}},{key:"getStyleOptions",value:function(){return o(this._chartPane.chartStore().styleOptions())}},{key:"setPriceVolumePrecision",value:function(t,e){l(t)&&t>=0&&l(e)&&e>=0&&this._chartPane.chartStore().setPriceVolumePrecision(t,e)}},{key:"setTimezone",value:function(t){this._chartPane.setTimezone(t)}},{key:"getTimezone",value:function(){return this._chartPane.chartStore().timeScaleStore().timezone()}},{key:"resize",value:function(){this._chartPane.adjustPaneViewport(!0,!0,!0,!0,!0)}},{key:"setOffsetRightSpace",value:function(t){l(t)&&this._chartPane.chartStore().timeScaleStore().setOffsetRightSpace(t,!0)}},{key:"setLeftMinVisibleBarCount",value:function(t){l(t)&&t>0&&this._chartPane.chartStore().timeScaleStore().setLeftMinVisibleBarCount(Math.ceil(t))}},{key:"setRightMinVisibleBarCount",value:function(t){l(t)&&t>0&&this._chartPane.chartStore().timeScaleStore().setRightMinVisibleBarCount(Math.ceil(t))}},{key:"setDataSpace",value:function(t){l(t)&&this._chartPane.chartStore().timeScaleStore().setDataSpace(t)}},{key:"getDataSpace",value:function(){return this._chartPane.chartStore().timeScaleStore().dataSpace()}},{key:"getBarSpace",value:function(){return this._chartPane.chartStore().timeScaleStore().barSpace()}},{key:"clearData",value:function(){this._chartPane.chartStore().clearDataList()}},{key:"getDataList",value:function(){return this._chartPane.chartStore().dataList()}},{key:"applyNewData",value:function(t,e){var i=this;if(s(t)){var n=this._chartPane.chartStore();n.clearDataList(),n.addData(t,0,e),n.technicalIndicatorStore().calcInstance().finally((function(t){i._chartPane.adjustPaneViewport(!1,!0,!0,!0)}))}}},{key:"applyMoreData",value:function(t,e){var i=this;if(s(t)){var n=this._chartPane.chartStore();n.addData(t,0,e),n.technicalIndicatorStore().calcInstance().finally((function(t){i._chartPane.adjustPaneViewport(!1,!0,!0,!0)}))}}},{key:"updateData",value:function(t){var e=this;if(h(t)&&!s(t)){var i=this._chartPane.chartStore(),n=i.dataList(),r=n.length,a=Y(t,"timestamp",0),o=Y(n[r-1],"timestamp",0);if(a>=o){var c=r;a===o&&(c=r-1),i.addData(t,c),i.technicalIndicatorStore().calcInstance().finally((function(t){e._chartPane.adjustPaneViewport(!1,!0,!0,!0)}))}}}},{key:"loadMore",value:function(t){c(t)&&this._chartPane.chartStore().timeScaleStore().setLoadMoreCallback(t)}},{key:"createTechnicalIndicator",value:function(t,e,i){if(!u(t))return null;var n=h(t)&&!s(t)?t:{name:t};return this._chartPane.chartStore().technicalIndicatorStore().hasTemplate(n.name)?this._chartPane.createTechnicalIndicator(n,e,i):null}},{key:"addTechnicalIndicatorTemplate",value:function(t){if(h(t)){var e=[].concat(t);this._chartPane.chartStore().technicalIndicatorStore().addTemplate(e)}}},{key:"overrideTechnicalIndicator",value:function(t,e){var i=this;if(h(t)&&!s(t)){var n=this._chartPane.chartStore().technicalIndicatorStore().override(t,e);n&&n.then((function(t){i._chartPane.adjustPaneViewport(!1,!0,!0,!0)}))}}},{key:"getTechnicalIndicatorTemplate",value:function(t){return this._chartPane.chartStore().technicalIndicatorStore().getTemplateInfo(t)}},{key:"getTechnicalIndicatorByPaneId",value:function(t,e){return this._chartPane.chartStore().technicalIndicatorStore().getInstanceInfo(t,e)}},{key:"removeTechnicalIndicator",value:function(t,e){this._chartPane.removeTechnicalIndicator(t,e)}},{key:"addShapeTemplate",value:function(t){if(h(t)){var e=[].concat(t);this._chartPane.chartStore().shapeStore().addTemplate(e)}}},{key:"createShape",value:function(t,e){if(!u(t))return null;var i=h(t)&&!s(t)?t:{name:t},n=this._chartPane.chartStore().shapeStore().getTemplate(i.name);return n?this._chartPane.createShape(n,i,e):null}},{key:"getShape",value:function(t){return this._chartPane.chartStore().shapeStore().getInstanceInfo(t)}},{key:"setShapeOptions",value:function(t){h(t)&&!s(t)&&this._chartPane.chartStore().shapeStore().setInstanceOptions(t)}},{key:"removeShape",value:function(t){this._chartPane.chartStore().shapeStore().removeInstance(t)}},{key:"createAnnotation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn;if(h(t)&&this._chartPane.hasPane(e)){var i=[].concat(t);this._chartPane.createAnnotation(i,e)}}},{key:"removeAnnotation",value:function(t,e){this._chartPane.chartStore().annotationStore().remove(t,e)}},{key:"createTag",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn;if(h(t)&&this._chartPane.hasPane(e)){var i=[].concat(t);this._chartPane.createTag(i,e)}}},{key:"removeTag",value:function(t,e){this._chartPane.chartStore().tagStore().remove(t,e)}},{key:"createHtml",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn;if(!h(t))return null;if(!(d(t.content)||t.content instanceof HTMLElement))return null;var i=this._chartPane.getPane(e);return i?i.createHtml(t):null}},{key:"removeHtml",value:function(t,e){if(t){var i=this._chartPane.getPane(t);i&&i.removeHtml(e)}else this._chartPane.removeAllHtml()}},{key:"setPaneOptions",value:function(t){h(t)&&this._chartPane.setPaneOptions(t,!1)}},{key:"setZoomEnabled",value:function(t){this._chartPane.chartStore().timeScaleStore().setZoomEnabled(t)}},{key:"isZoomEnabled",value:function(){return this._chartPane.chartStore().timeScaleStore().zoomEnabled()}},{key:"setScrollEnabled",value:function(t){this._chartPane.chartStore().timeScaleStore().setScrollEnabled(t)}},{key:"isScrollEnabled",value:function(){return this._chartPane.chartStore().timeScaleStore().scrollEnabled()}},{key:"scrollByDistance",value:function(t,e){var i=this;if(l(t))if(l(e)&&e>0){this._chartPane.chartStore().timeScaleStore().startScroll();var n=(new Date).getTime();!function r(){var a=((new Date).getTime()-n)/e,o=a>=1,s=o?t:t*a;i._chartPane.chartStore().timeScaleStore().scroll(s),o||Ee(r)}()}else this._chartPane.chartStore().timeScaleStore().startScroll(),this._chartPane.chartStore().timeScaleStore().scroll(t)}},{key:"scrollToRealTime",value:function(t){var e=this._chartPane.chartStore().timeScaleStore().dataSpace(),i=this._chartPane.chartStore().timeScaleStore().offsetRightBarCount()-this._chartPane.chartStore().timeScaleStore().offsetRightSpace()/e;this.scrollByDistance(i*e,t)}},{key:"scrollToDataIndex",value:function(t,e){if(l(t)){var i=(this._chartPane.chartStore().timeScaleStore().offsetRightBarCount()+(this.getDataList().length-1-t))*this._chartPane.chartStore().timeScaleStore().dataSpace();this.scrollByDistance(i,e)}}},{key:"scrollToTimestamp",value:function(t,e){if(l(t)){var i=G(this.getDataList(),"timestamp",t);this.scrollToDataIndex(i,e)}}},{key:"zoomAtCoordinate",value:function(t,e,i){var n=this;if(l(t))if(l(i)&&i>0){var r=this._chartPane.chartStore().timeScaleStore().dataSpace(),a=r*t-r,o=(new Date).getTime();!function t(){var s=((new Date).getTime()-o)/i,c=s>=1,h=c?a:a*s;n._chartPane.chartStore().timeScaleStore().zoom(h/r,e),c||Ee(t)}()}else this._chartPane.chartStore().timeScaleStore().zoom(t,e)}},{key:"zoomAtDataIndex",value:function(t,e,i){if(l(t)&&l(e)){var n=this._chartPane.chartStore().timeScaleStore().dataIndexToCoordinate(e);this.zoomAtCoordinate(t,{x:n},i)}}},{key:"zoomAtTimestamp",value:function(t,e,i){if(l(t)&&l(e)){var n=G(this.getDataList(),"timestamp",e);this.zoomAtDataIndex(t,n,i)}}},{key:"convertToPixel",value:function(t,e){return this._chartPane.convertToPixel(t,e)}},{key:"convertFromPixel",value:function(t,e){return this._chartPane.convertFromPixel(t,e)}},{key:"subscribeAction",value:function(t,e){q(t)&&c(e)&&this._chartPane.chartStore().actionStore().subscribe(t,e)}},{key:"unsubscribeAction",value:function(t,e){q(t)&&this._chartPane.chartStore().actionStore().unsubscribe(t,e)}},{key:"getConvertPictureUrl",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"jpeg",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#FFFFFF";if("png"===e||"jpeg"===e||"bmp"===e)return this._chartPane.getConvertPictureUrl(t,e,i)}},{key:"destroy",value:function(){this._chartPane.destroy()}}]),t}(),sn={},cn=1,hn="k_line_chart_";var ln={version:function(){return"8.6.2"},init:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return null;if(!(e=d(t)?document.getElementById(t):t))return null;var n=sn[e.chartId||""];if(n)return n;var r="".concat(hn).concat(cn++);return(n=new on(e,i)).id=r,e.chartId=r,sn[r]=n,n},dispose:function(t){if(t){var e;if(d(t)){var i=document.getElementById(t);e=i&&i.chartId}else e=t instanceof on?t.id:t&&t.chartId;e&&(sn[e].destroy(),delete sn[e])}},utils:{clone:o,merge:a,isString:d,isNumber:l,isValid:u,isObject:h,isArray:s,isFunction:c,isBoolean:f,formatValue:Y,formatPrecision:N,formatBigNumber:X},extension:t};return ln}));
